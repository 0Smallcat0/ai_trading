# 核心模組功能總結 (Core Modules Summary)

本文檔提供了 AI 股票自動交易系統核心模組的功能總結，重點說明各模組的主要功能和特色。

## 1. 資料擷取模組 (`src/core/data_ingest.py`)

資料擷取模組負責從各種來源獲取股票資料，並進行預處理和標準化。

### 主要功能

- **多來源整合**：支援從 Yahoo Finance、Alpha Vantage、FinMind、券商 API 等多種來源獲取資料
- **多種資料類型**：支援價格、成交量、財務報表、技術指標等多種資料類型
- **WebSocket 支援**：實現 WebSocket 自動重連和背壓控制
- **請求速率限制**：提供請求速率限制和自動故障轉移機制
- **資料標準化**：統一不同來源的資料格式
- **定時更新**：支援定時更新和資料快取
- **資料驗證**：確保資料的完整性和準確性

## 2. 特徵工程模組 (`src/core/features.py`)

特徵工程模組負責處理和生成交易特徵，為信號生成和模型訓練提供輸入。

### 主要功能

- **技術指標計算**：計算 RSI、MACD、KD 等技術指標
- **基本面指標計算**：計算 ROE、ROA、EPS 等基本面指標
- **特徵工程**：進行資料轉換和特徵生成
- **資料清理**：處理缺失值、異常值和資料標準化
- **分散式處理**：支援使用 Dask 和 Ray 進行分散式處理
- **特徵選擇**：進行特徵選擇和降維
- **特徵重要性**：計算和視覺化特徵重要性

## 3. 信號生成模組 (`src/core/signal_gen.py`)

信號生成模組負責根據不同的策略生成交易信號，為交易決策提供依據。

### 主要功能

- **多策略支援**：支援基本面、動量、均值回歸、新聞情緒等多種策略
- **信號合併**：合併多策略信號並進行權重調整
- **信號評估**：評估信號質量和表現
- **信號視覺化**：視覺化信號生成結果
- **信號過濾**：過濾低質量信號
- **信號優化**：優化信號生成參數
- **時間序列分析**：分析信號的時間序列特性

## 4. 回測模組 (`src/core/backtest.py`)

回測模組負責模擬交易策略的歷史表現，評估策略的有效性。

### 主要功能

- **策略執行**：模擬策略執行過程，追蹤資金和部位變化
- **市場模擬**：模擬各種市場情境，包括崩盤、流動性不足、高波動性等
- **績效評估**：計算各種績效指標，如報酬率、夏普比率、最大回撤等
- **多策略比較**：支援多策略比較和報告生成
- **Backtrader 整合**：整合 Backtrader 框架提供更豐富的回測功能
- **混合型回測**：支援新聞情感因子注入的混合型回測

## 5. 投資組合管理模組 (`src/core/portfolio.py`)

投資組合管理模組負責管理資產配置和持倉，優化投資組合表現。

### 主要功能

- **資產配置**：支援等權重、風險平價、最大夏普比率、最小方差等多種配置方法
- **持倉管理**：管理多資產持倉和動態模擬
- **投資組合優化**：優化投資組合以達到特定目標
- **績效評估**：評估投資組合表現
- **再平衡**：實現投資組合再平衡策略
- **多策略整合**：整合多策略投資組合

## 6. 風險控制模組 (`src/core/risk_control.py`)

風險控制模組負責管理交易風險，確保交易安全。

### 主要功能

- **停損/停利**：實現停損和停利規則
- **資金配置**：控制資金配置和部位規模
- **風險指標**：計算 VaR、CVaR、波動率等風險指標
- **風險控制**：實現策略和投資組合層級的風險控制
- **風險預算**：實現風險預算和風險平價
- **動態調整**：根據市場情況動態調整風險參數
- **極端情境測試**：測試策略在極端市場情況下的表現

## 模組間的整合

這些核心模組緊密整合，形成一個完整的交易系統：

1. **資料流**：
   - 資料擷取模組獲取原始資料
   - 特徵工程模組處理資料並生成特徵
   - 信號生成模組基於特徵生成交易信號
   - 回測模組使用信號模擬交易
   - 投資組合管理模組優化資產配置
   - 風險控制模組確保交易安全

2. **資料結構**：
   - 所有模組使用統一的資料結構（主要是 pandas DataFrame）
   - 時間序列資料使用 MultiIndex 結構，方便跨股票和時間的分析

3. **配置共享**：
   - 所有模組共享 `config.py` 中的配置
   - 環境特定設定從 `.env` 文件加載

## 最佳實踐

使用這些模組時，請遵循以下最佳實踐：

1. **資料處理**：
   - 始終檢查缺失值和異常值
   - 使用提供的資料清理函數
   - 避免前瞻偏差（look-ahead bias）

2. **性能優化**：
   - 對大型資料集使用分散式處理
   - 適當快取中間結果
   - 監控記憶體使用情況

3. **風險管理**：
   - 始終對交易信號應用風險控制
   - 在各種市場情況下測試策略
   - 監控回撤和其他風險指標

4. **代碼組織**：
   - 遵循模組化結構
   - 為新功能編寫單元測試
   - 使用文檔字符串和註釋記錄代碼
