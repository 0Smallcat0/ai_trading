# ç³»çµ±éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—è©³ç´°èªªæ˜ AI è‚¡ç¥¨è‡ªå‹•äº¤æ˜“ç³»çµ±çš„éƒ¨ç½²æµç¨‹ï¼ŒåŒ…æ‹¬ç’°å¢ƒè¨­ç½®ã€é…ç½®ç®¡ç†ã€éƒ¨ç½²æ­¥é©Ÿå’Œå¸¸è¦‹å•é¡Œè§£æ±ºæ–¹æ¡ˆã€‚

## ğŸ“š ç›®éŒ„

1. [éƒ¨ç½²æ¦‚è¦½](#éƒ¨ç½²æ¦‚è¦½)
2. [ç’°å¢ƒæº–å‚™](#ç’°å¢ƒæº–å‚™)
3. [æœ¬åœ°éƒ¨ç½²](#æœ¬åœ°éƒ¨ç½²)
4. [Docker éƒ¨ç½²](#docker-éƒ¨ç½²)
5. [ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²](#ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²)
6. [é…ç½®ç®¡ç†](#é…ç½®ç®¡ç†)
7. [ç›£æ§èˆ‡ç¶­è­·](#ç›£æ§èˆ‡ç¶­è­·)
8. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## ğŸŒ éƒ¨ç½²æ¦‚è¦½

### ç³»çµ±æ¶æ§‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è² è¼‰å‡è¡¡å™¨     â”‚    â”‚   Web æ‡‰ç”¨      â”‚    â”‚   API æœå‹™      â”‚
â”‚   (Nginx)       â”‚â—„â”€â”€â–ºâ”‚   (Streamlit)   â”‚â—„â”€â”€â–ºâ”‚   (FastAPI)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                        â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   è³‡æ–™åº«        â”‚    â”‚   ç›£æ§ç³»çµ±      â”‚
                       â”‚   (PostgreSQL)  â”‚    â”‚   (Prometheus)  â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éƒ¨ç½²é¸é …

#### 1. æœ¬åœ°é–‹ç™¼éƒ¨ç½²
- **é©ç”¨å ´æ™¯**ï¼šé–‹ç™¼å’Œæ¸¬è©¦
- **è³‡æºéœ€æ±‚**ï¼š4GB RAM, 2 CPU æ ¸å¿ƒ
- **éƒ¨ç½²æ™‚é–“**ï¼š10-15 åˆ†é˜

#### 2. Docker å®¹å™¨éƒ¨ç½²
- **é©ç”¨å ´æ™¯**ï¼šæ¸¬è©¦å’Œå°è¦æ¨¡ç”Ÿç”¢
- **è³‡æºéœ€æ±‚**ï¼š8GB RAM, 4 CPU æ ¸å¿ƒ
- **éƒ¨ç½²æ™‚é–“**ï¼š15-20 åˆ†é˜

#### 3. Kubernetes é›†ç¾¤éƒ¨ç½²
- **é©ç”¨å ´æ™¯**ï¼šå¤§è¦æ¨¡ç”Ÿç”¢ç’°å¢ƒ
- **è³‡æºéœ€æ±‚**ï¼š16GB+ RAM, 8+ CPU æ ¸å¿ƒ
- **éƒ¨ç½²æ™‚é–“**ï¼š30-45 åˆ†é˜

### ç³»çµ±è¦æ±‚

#### æœ€ä½è¦æ±‚
- **CPU**ï¼š2 æ ¸å¿ƒ
- **è¨˜æ†¶é«”**ï¼š4GB
- **å„²å­˜**ï¼š20GB å¯ç”¨ç©ºé–“
- **ç¶²è·¯**ï¼šç©©å®šçš„ç¶²è·¯é€£æ¥

#### å»ºè­°é…ç½®
- **CPU**ï¼š4+ æ ¸å¿ƒ
- **è¨˜æ†¶é«”**ï¼š8GB+
- **å„²å­˜**ï¼š50GB+ SSD
- **ç¶²è·¯**ï¼š100Mbps+ é »å¯¬

---

## ğŸ› ï¸ ç’°å¢ƒæº–å‚™

### ä½œæ¥­ç³»çµ±æ”¯æ´
- **Linux**ï¼šUbuntu 18.04+, CentOS 7+, RHEL 7+
- **Windows**ï¼šWindows 10+, Windows Server 2019+
- **macOS**ï¼šmacOS 10.15+

### å¿…è¦è»Ÿé«”å®‰è£

#### 1. Python ç’°å¢ƒ
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install python3.8 python3.8-pip python3.8-venv

# CentOS/RHEL
sudo yum install python38 python38-pip

# macOS (ä½¿ç”¨ Homebrew)
brew install python@3.8

# Windows (ä½¿ç”¨ Chocolatey)
choco install python --version=3.8.10
```

#### 2. Poetry å®‰è£
```bash
# æ‰€æœ‰å¹³å°
curl -sSL https://install.python-poetry.org | python3 -

# æˆ–ä½¿ç”¨ pip
pip install poetry

# é©—è­‰å®‰è£
poetry --version
```

#### 3. Git å®‰è£
```bash
# Ubuntu/Debian
sudo apt install git

# CentOS/RHEL
sudo yum install git

# macOS
brew install git

# Windows
choco install git
```

#### 4. Docker å®‰è£ï¼ˆå¯é¸ï¼‰
```bash
# Ubuntu
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# å•Ÿå‹• Docker æœå‹™
sudo systemctl start docker
sudo systemctl enable docker

# å°‡ç”¨æˆ¶æ·»åŠ åˆ° docker çµ„
sudo usermod -aG docker $USER
```

### è³‡æ–™åº«æº–å‚™

#### PostgreSQL å®‰è£ï¼ˆç”Ÿç”¢ç’°å¢ƒå»ºè­°ï¼‰
```bash
# Ubuntu/Debian
sudo apt install postgresql postgresql-contrib

# å‰µå»ºè³‡æ–™åº«å’Œç”¨æˆ¶
sudo -u postgres psql
CREATE DATABASE trading_system;
CREATE USER trading_user WITH PASSWORD 'secure_password';
GRANT ALL PRIVILEGES ON DATABASE trading_system TO trading_user;
\q
```

#### SQLiteï¼ˆé–‹ç™¼ç’°å¢ƒï¼‰
```bash
# SQLite é€šå¸¸å·²é è£ï¼Œç„¡éœ€é¡å¤–å®‰è£
sqlite3 --version
```

---

## ğŸ’» æœ¬åœ°éƒ¨ç½²

### 1. ç²å–æºä»£ç¢¼
```bash
# å…‹éš†å°ˆæ¡ˆ
git clone https://github.com/your-org/ai-trading-system.git
cd ai-trading-system

# åˆ‡æ›åˆ°ç©©å®šç‰ˆæœ¬
git checkout v1.0.0
```

### 2. ç’°å¢ƒé…ç½®
```bash
# å®‰è£ä¾è³´
poetry install

# å•Ÿå‹•è™›æ“¬ç’°å¢ƒ
poetry shell

# è¤‡è£½ç’°å¢ƒé…ç½®æ–‡ä»¶
cp .env.example .env
```

### 3. é…ç½®æ–‡ä»¶è¨­ç½®
ç·¨è¼¯ `.env` æ–‡ä»¶ï¼š
```bash
# åŸºæœ¬é…ç½®
ENV=development
DEBUG=true

# è³‡æ–™åº«é…ç½®
DATABASE_URL=sqlite:///./data/trading.db

# API é…ç½®
API_HOST=127.0.0.1
API_PORT=8000
SECRET_KEY=your-secret-key-here

# Streamlit é…ç½®
STREAMLIT_HOST=127.0.0.1
STREAMLIT_PORT=8501

# æ—¥èªŒé…ç½®
LOG_LEVEL=INFO
LOG_FILE=logs/system.log
```

### 4. è³‡æ–™åº«åˆå§‹åŒ–
```bash
# å‰µå»ºè³‡æ–™åº«è¡¨
python scripts/setup_database.py

# åŸ·è¡Œè³‡æ–™åº«é·ç§»
python scripts/migrate_database.py

# è¼‰å…¥åˆå§‹æ•¸æ“šï¼ˆå¯é¸ï¼‰
python scripts/load_sample_data.py
```

### 5. å•Ÿå‹•æœå‹™
```bash
# æ–¹æ³• 1ï¼šä½¿ç”¨å•Ÿå‹•è…³æœ¬
./scripts/start_app.sh

# æ–¹æ³• 2ï¼šæ‰‹å‹•å•Ÿå‹•
# çµ‚ç«¯ 1ï¼šå•Ÿå‹• API æœå‹™
poetry run uvicorn src.api.main:app --host 127.0.0.1 --port 8000 --reload

# çµ‚ç«¯ 2ï¼šå•Ÿå‹• Web UI
poetry run python -m streamlit run src/ui/web_ui.py --server.address=127.0.0.1 --server.port=8501
```

### 6. é©—è­‰éƒ¨ç½²
```bash
# æª¢æŸ¥ API æœå‹™
curl http://localhost:8000/api/health

# æª¢æŸ¥ Web UI
curl http://localhost:8501

# åŸ·è¡ŒåŸºæœ¬æ¸¬è©¦
poetry run pytest tests/integration/test_basic_functionality.py
```

---

## ğŸ³ Docker éƒ¨ç½²

### 1. å»ºæ§‹ Docker æ˜ åƒ
```bash
# å»ºæ§‹é–‹ç™¼æ˜ åƒ
docker build -f Dockerfile.dev -t trading-system:dev .

# å»ºæ§‹ç”Ÿç”¢æ˜ åƒ
docker build -f Dockerfile -t trading-system:latest .
```

### 2. ä½¿ç”¨ Docker Compose

#### é–‹ç™¼ç’°å¢ƒ
```yaml
# docker-compose.dev.yml
version: '3.8'

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - "8501:8501"
      - "8000:8000"
    environment:
      - ENV=development
      - DATABASE_URL=sqlite:///./data/trading.db
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
    restart: unless-stopped

  db:
    image: postgres:13
    environment:
      POSTGRES_DB: trading_system
      POSTGRES_USER: trading_user
      POSTGRES_PASSWORD: secure_password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped

volumes:
  postgres_data:
```

#### ç”Ÿç”¢ç’°å¢ƒ
```yaml
# docker-compose.prod.yml
version: '3.8'

services:
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - app
    restart: unless-stopped

  app:
    image: trading-system:latest
    environment:
      - ENV=production
      - DATABASE_URL=postgresql://trading_user:secure_password@db:5432/trading_system
      - SECRET_KEY=${SECRET_KEY}
    depends_on:
      - db
      - redis
    restart: unless-stopped
    deploy:
      replicas: 2

  db:
    image: postgres:13
    environment:
      POSTGRES_DB: trading_system
      POSTGRES_USER: trading_user
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped

  redis:
    image: redis:alpine
    restart: unless-stopped

  prometheus:
    image: prom/prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./config/prometheus.yml:/etc/prometheus/prometheus.yml
    restart: unless-stopped

  grafana:
    image: grafana/grafana
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}
    volumes:
      - grafana_data:/var/lib/grafana
    restart: unless-stopped

volumes:
  postgres_data:
  grafana_data:
```

### 3. å•Ÿå‹•æœå‹™
```bash
# é–‹ç™¼ç’°å¢ƒ
docker-compose -f docker-compose.dev.yml up -d

# ç”Ÿç”¢ç’°å¢ƒ
docker-compose -f docker-compose.prod.yml up -d

# æŸ¥çœ‹æœå‹™ç‹€æ…‹
docker-compose ps

# æŸ¥çœ‹æ—¥èªŒ
docker-compose logs -f app
```

---

## ğŸš€ ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²

### 1. ä¼ºæœå™¨æº–å‚™

#### ç³»çµ±å„ªåŒ–
```bash
# æ›´æ–°ç³»çµ±
sudo apt update && sudo apt upgrade -y

# è¨­ç½®é˜²ç«ç‰†
sudo ufw enable
sudo ufw allow 22    # SSH
sudo ufw allow 80    # HTTP
sudo ufw allow 443   # HTTPS

# å„ªåŒ–ç³»çµ±åƒæ•¸
echo 'vm.max_map_count=262144' | sudo tee -a /etc/sysctl.conf
echo 'fs.file-max=65536' | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

#### SSL æ†‘è­‰è¨­ç½®
```bash
# ä½¿ç”¨ Let's Encrypt
sudo apt install certbot python3-certbot-nginx

# ç²å– SSL æ†‘è­‰
sudo certbot --nginx -d your-domain.com

# è¨­ç½®è‡ªå‹•æ›´æ–°
sudo crontab -e
# æ·»åŠ ï¼š0 12 * * * /usr/bin/certbot renew --quiet
```

### 2. ç’°å¢ƒè®Šæ•¸é…ç½®
```bash
# å‰µå»ºç”Ÿç”¢ç’°å¢ƒé…ç½®
cat > .env.prod << EOF
ENV=production
DEBUG=false

# è³‡æ–™åº«é…ç½®
DATABASE_URL=postgresql://trading_user:${DB_PASSWORD}@localhost:5432/trading_system

# å®‰å…¨é…ç½®
SECRET_KEY=${SECRET_KEY}
JWT_SECRET_KEY=${JWT_SECRET_KEY}

# API é…ç½®
API_HOST=0.0.0.0
API_PORT=8000

# ç›£æ§é…ç½®
PROMETHEUS_ENABLED=true
GRAFANA_ENABLED=true

# æ—¥èªŒé…ç½®
LOG_LEVEL=WARNING
LOG_FILE=/var/log/trading-system/system.log
EOF
```

### 3. ç³»çµ±æœå‹™é…ç½®

#### Systemd æœå‹™æ–‡ä»¶
```bash
# å‰µå»º API æœå‹™
sudo tee /etc/systemd/system/trading-api.service << EOF
[Unit]
Description=Trading System API
After=network.target

[Service]
Type=exec
User=trading
Group=trading
WorkingDirectory=/opt/trading-system
Environment=PATH=/opt/trading-system/.venv/bin
ExecStart=/opt/trading-system/.venv/bin/uvicorn src.api.main:app --host 0.0.0.0 --port 8000
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# å‰µå»º Web UI æœå‹™
sudo tee /etc/systemd/system/trading-web.service << EOF
[Unit]
Description=Trading System Web UI
After=network.target

[Service]
Type=exec
User=trading
Group=trading
WorkingDirectory=/opt/trading-system
Environment=PATH=/opt/trading-system/.venv/bin
ExecStart=/opt/trading-system/.venv/bin/python -m streamlit run src/ui/web_ui.py --server.address=127.0.0.1 --server.port=8501
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# å•Ÿå‹•æœå‹™
sudo systemctl daemon-reload
sudo systemctl enable trading-api trading-web
sudo systemctl start trading-api trading-web
```

### 4. Nginx é…ç½®
```nginx
# /etc/nginx/sites-available/trading-system
server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;

    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;

    # SSL é…ç½®
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;
    ssl_prefer_server_ciphers off;

    # Web UI
    location / {
        proxy_pass http://127.0.0.1:8501;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # API
    location /api/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # éœæ…‹æ–‡ä»¶
    location /static/ {
        alias /opt/trading-system/static/;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

### 5. å‚™ä»½ç­–ç•¥
```bash
# å‰µå»ºå‚™ä»½è…³æœ¬
cat > /opt/trading-system/scripts/backup.sh << 'EOF'
#!/bin/bash

BACKUP_DIR="/backup/trading-system"
DATE=$(date +%Y%m%d_%H%M%S)

# å‰µå»ºå‚™ä»½ç›®éŒ„
mkdir -p $BACKUP_DIR

# å‚™ä»½è³‡æ–™åº«
pg_dump -h localhost -U trading_user trading_system > $BACKUP_DIR/db_backup_$DATE.sql

# å‚™ä»½é…ç½®æ–‡ä»¶
tar -czf $BACKUP_DIR/config_backup_$DATE.tar.gz /opt/trading-system/.env* /opt/trading-system/config/

# å‚™ä»½æ•¸æ“šæ–‡ä»¶
tar -czf $BACKUP_DIR/data_backup_$DATE.tar.gz /opt/trading-system/data/

# æ¸…ç†èˆŠå‚™ä»½ï¼ˆä¿ç•™ 30 å¤©ï¼‰
find $BACKUP_DIR -name "*.sql" -mtime +30 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +30 -delete

echo "å‚™ä»½å®Œæˆ: $DATE"
EOF

chmod +x /opt/trading-system/scripts/backup.sh

# è¨­ç½®å®šæ™‚å‚™ä»½
sudo crontab -e
# æ·»åŠ ï¼š0 2 * * * /opt/trading-system/scripts/backup.sh
```

---

## âš™ï¸ é…ç½®ç®¡ç†

### ç’°å¢ƒé…ç½®

#### é–‹ç™¼ç’°å¢ƒ (.env.dev)
```bash
ENV=development
DEBUG=true
LOG_LEVEL=DEBUG

# è³‡æ–™åº«
DATABASE_URL=sqlite:///./data/trading.db

# API è¨­å®š
API_HOST=127.0.0.1
API_PORT=8000
SECRET_KEY=dev-secret-key

# å¤–éƒ¨æœå‹™ï¼ˆæ¸¬è©¦ç”¨ï¼‰
BROKER_API_URL=https://sandbox.broker.com
MARKET_DATA_API_URL=https://sandbox.marketdata.com
```

#### æ¸¬è©¦ç’°å¢ƒ (.env.test)
```bash
ENV=test
DEBUG=false
LOG_LEVEL=INFO

# æ¸¬è©¦è³‡æ–™åº«
DATABASE_URL=postgresql://test_user:test_pass@localhost:5432/test_trading

# API è¨­å®š
API_HOST=0.0.0.0
API_PORT=8000
SECRET_KEY=test-secret-key

# æ¸¬è©¦æœå‹™
BROKER_API_URL=https://test.broker.com
MARKET_DATA_API_URL=https://test.marketdata.com
```

#### ç”Ÿç”¢ç’°å¢ƒ (.env.prod)
```bash
ENV=production
DEBUG=false
LOG_LEVEL=WARNING

# ç”Ÿç”¢è³‡æ–™åº«
DATABASE_URL=postgresql://prod_user:${DB_PASSWORD}@db-cluster:5432/trading_system

# å®‰å…¨è¨­å®š
SECRET_KEY=${SECRET_KEY}
JWT_SECRET_KEY=${JWT_SECRET_KEY}
ENCRYPTION_KEY=${ENCRYPTION_KEY}

# ç”Ÿç”¢æœå‹™
BROKER_API_URL=https://api.broker.com
MARKET_DATA_API_URL=https://api.marketdata.com

# ç›£æ§è¨­å®š
PROMETHEUS_ENABLED=true
GRAFANA_ENABLED=true
SENTRY_DSN=${SENTRY_DSN}
```

### é…ç½®é©—è­‰
```bash
# å‰µå»ºé…ç½®é©—è­‰è…³æœ¬
cat > scripts/validate_config.py << 'EOF'
#!/usr/bin/env python3
import os
import sys
from urllib.parse import urlparse

def validate_config():
    """é©—è­‰é…ç½®æ–‡ä»¶ã€‚"""
    errors = []

    # æª¢æŸ¥å¿…è¦ç’°å¢ƒè®Šæ•¸
    required_vars = [
        'ENV', 'DATABASE_URL', 'SECRET_KEY', 'API_HOST', 'API_PORT'
    ]

    for var in required_vars:
        if not os.getenv(var):
            errors.append(f"ç¼ºå°‘ç’°å¢ƒè®Šæ•¸: {var}")

    # é©—è­‰è³‡æ–™åº« URL
    db_url = os.getenv('DATABASE_URL')
    if db_url:
        try:
            parsed = urlparse(db_url)
            if not parsed.scheme:
                errors.append("è³‡æ–™åº« URL æ ¼å¼éŒ¯èª¤")
        except Exception as e:
            errors.append(f"è³‡æ–™åº« URL è§£æéŒ¯èª¤: {e}")

    # æª¢æŸ¥ç«¯å£è™Ÿ
    api_port = os.getenv('API_PORT')
    if api_port:
        try:
            port = int(api_port)
            if not (1 <= port <= 65535):
                errors.append("API ç«¯å£è™Ÿè¶…å‡ºæœ‰æ•ˆç¯„åœ")
        except ValueError:
            errors.append("API ç«¯å£è™Ÿå¿…é ˆæ˜¯æ•¸å­—")

    # æª¢æŸ¥å¯†é‘°é•·åº¦
    secret_key = os.getenv('SECRET_KEY')
    if secret_key and len(secret_key) < 32:
        errors.append("SECRET_KEY é•·åº¦ä¸è¶³ï¼ˆå»ºè­°è‡³å°‘ 32 å­—ç¬¦ï¼‰")

    if errors:
        print("é…ç½®é©—è­‰å¤±æ•—:")
        for error in errors:
            print(f"  - {error}")
        sys.exit(1)
    else:
        print("é…ç½®é©—è­‰é€šé")

if __name__ == "__main__":
    validate_config()
EOF

chmod +x scripts/validate_config.py
```

---

## ğŸ“Š ç›£æ§èˆ‡ç¶­è­·

### ç³»çµ±ç›£æ§

#### Prometheus é…ç½®
```yaml
# config/prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "alert_rules.yml"

scrape_configs:
  - job_name: 'trading-system'
    static_configs:
      - targets: ['localhost:8000']
    metrics_path: '/metrics'
    scrape_interval: 5s

  - job_name: 'node-exporter'
    static_configs:
      - targets: ['localhost:9100']

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093
```

#### å‘Šè­¦è¦å‰‡
```yaml
# config/alert_rules.yml
groups:
  - name: trading_system_alerts
    rules:
      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.1
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "é«˜éŒ¯èª¤ç‡æª¢æ¸¬"
          description: "éŒ¯èª¤ç‡è¶…é 10%"

      - alert: HighResponseTime
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "å›æ‡‰æ™‚é–“éé•·"
          description: "95% å›æ‡‰æ™‚é–“è¶…é 1 ç§’"

      - alert: DatabaseConnectionFailed
        expr: up{job="postgres"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "è³‡æ–™åº«é€£æ¥å¤±æ•—"
          description: "ç„¡æ³•é€£æ¥åˆ°è³‡æ–™åº«"
```

#### Grafana å„€è¡¨æ¿
```json
{
  "dashboard": {
    "title": "Trading System Dashboard",
    "panels": [
      {
        "title": "API è«‹æ±‚ç‡",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(http_requests_total[5m])",
            "legendFormat": "{{method}} {{endpoint}}"
          }
        ]
      },
      {
        "title": "å›æ‡‰æ™‚é–“",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "95th percentile"
          }
        ]
      },
      {
        "title": "ç³»çµ±è³‡æºä½¿ç”¨",
        "type": "graph",
        "targets": [
          {
            "expr": "100 - (avg by (instance) (rate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)",
            "legendFormat": "CPU ä½¿ç”¨ç‡"
          },
          {
            "expr": "(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100",
            "legendFormat": "è¨˜æ†¶é«”ä½¿ç”¨ç‡"
          }
        ]
      }
    ]
  }
}
```

### æ—¥èªŒç®¡ç†

#### æ—¥èªŒè¼ªè½‰é…ç½®
```bash
# /etc/logrotate.d/trading-system
/var/log/trading-system/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 trading trading
    postrotate
        systemctl reload trading-api trading-web
    endscript
}
```

#### æ—¥èªŒç›£æ§è…³æœ¬
```bash
# scripts/monitor_logs.sh
#!/bin/bash

LOG_DIR="/var/log/trading-system"
ERROR_THRESHOLD=10
WARNING_THRESHOLD=50

# æª¢æŸ¥éŒ¯èª¤æ—¥èªŒ
error_count=$(grep -c "ERROR" $LOG_DIR/system.log)
warning_count=$(grep -c "WARNING" $LOG_DIR/system.log)

if [ $error_count -gt $ERROR_THRESHOLD ]; then
    echo "ALERT: éŒ¯èª¤æ—¥èªŒæ•¸é‡éå¤š ($error_count)"
    # ç™¼é€å‘Šè­¦é€šçŸ¥
    curl -X POST "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK" \
         -H 'Content-type: application/json' \
         --data "{\"text\":\"Trading System Alert: éŒ¯èª¤æ—¥èªŒæ•¸é‡éå¤š ($error_count)\"}"
fi

if [ $warning_count -gt $WARNING_THRESHOLD ]; then
    echo "WARNING: è­¦å‘Šæ—¥èªŒæ•¸é‡è¼ƒå¤š ($warning_count)"
fi
```

### å¥åº·æª¢æŸ¥

#### å¥åº·æª¢æŸ¥ç«¯é»
```python
# src/api/health.py
from fastapi import APIRouter, HTTPException
from sqlalchemy import text
from src.database.database_manager import DatabaseManager

router = APIRouter()

@router.get("/health")
async def health_check():
    """ç³»çµ±å¥åº·æª¢æŸ¥ã€‚"""
    checks = {
        "status": "healthy",
        "timestamp": datetime.utcnow().isoformat(),
        "checks": {}
    }

    # æª¢æŸ¥è³‡æ–™åº«é€£æ¥
    try:
        db = DatabaseManager()
        with db.get_connection() as conn:
            conn.execute(text("SELECT 1"))
        checks["checks"]["database"] = "healthy"
    except Exception as e:
        checks["checks"]["database"] = f"unhealthy: {str(e)}"
        checks["status"] = "unhealthy"

    # æª¢æŸ¥å¤–éƒ¨ API
    try:
        # æª¢æŸ¥åˆ¸å•† API
        response = requests.get(f"{BROKER_API_URL}/health", timeout=5)
        if response.status_code == 200:
            checks["checks"]["broker_api"] = "healthy"
        else:
            checks["checks"]["broker_api"] = f"unhealthy: HTTP {response.status_code}"
    except Exception as e:
        checks["checks"]["broker_api"] = f"unhealthy: {str(e)}"

    # æª¢æŸ¥ç£ç¢Ÿç©ºé–“
    import shutil
    total, used, free = shutil.disk_usage("/")
    free_percent = (free / total) * 100
    if free_percent < 10:
        checks["checks"]["disk_space"] = f"warning: {free_percent:.1f}% free"
        checks["status"] = "degraded"
    else:
        checks["checks"]["disk_space"] = f"healthy: {free_percent:.1f}% free"

    if checks["status"] == "unhealthy":
        raise HTTPException(status_code=503, detail=checks)

    return checks
```

### ç¶­è­·ä»»å‹™

#### å®šæœŸç¶­è­·è…³æœ¬
```bash
# scripts/maintenance.sh
#!/bin/bash

echo "é–‹å§‹ç³»çµ±ç¶­è­·..."

# æ¸…ç†è‡¨æ™‚æ–‡ä»¶
find /tmp -name "trading_*" -mtime +7 -delete

# æ¸…ç†èˆŠæ—¥èªŒ
find /var/log/trading-system -name "*.log.*" -mtime +30 -delete

# å„ªåŒ–è³‡æ–™åº«
sudo -u postgres psql trading_system -c "VACUUM ANALYZE;"

# é‡å•Ÿæœå‹™ï¼ˆå¦‚éœ€è¦ï¼‰
if [ "$1" = "--restart" ]; then
    systemctl restart trading-api trading-web
fi

# æª¢æŸ¥ç³»çµ±ç‹€æ…‹
systemctl status trading-api trading-web

echo "ç³»çµ±ç¶­è­·å®Œæˆ"
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. æœå‹™å•Ÿå‹•å¤±æ•—
```bash
# æª¢æŸ¥æœå‹™ç‹€æ…‹
systemctl status trading-api

# æŸ¥çœ‹è©³ç´°æ—¥èªŒ
journalctl -u trading-api -f

# æª¢æŸ¥é…ç½®æ–‡ä»¶
python scripts/validate_config.py

# æª¢æŸ¥ç«¯å£ä½”ç”¨
netstat -tulpn | grep :8000
```

#### 2. è³‡æ–™åº«é€£æ¥å•é¡Œ
```bash
# æª¢æŸ¥è³‡æ–™åº«æœå‹™
systemctl status postgresql

# æ¸¬è©¦è³‡æ–™åº«é€£æ¥
psql -h localhost -U trading_user -d trading_system -c "SELECT version();"

# æª¢æŸ¥é€£æ¥æ•¸
psql -h localhost -U postgres -c "SELECT count(*) FROM pg_stat_activity;"
```

#### 3. è¨˜æ†¶é«”ä¸è¶³
```bash
# æª¢æŸ¥è¨˜æ†¶é«”ä½¿ç”¨
free -h
ps aux --sort=-%mem | head -10

# æª¢æŸ¥äº¤æ›ç©ºé–“
swapon --show

# æ¸…ç†ç³»çµ±å¿«å–
sync && echo 3 > /proc/sys/vm/drop_caches
```

#### 4. ç£ç¢Ÿç©ºé–“ä¸è¶³
```bash
# æª¢æŸ¥ç£ç¢Ÿä½¿ç”¨
df -h

# æŸ¥æ‰¾å¤§æ–‡ä»¶
find / -type f -size +100M 2>/dev/null | head -10

# æ¸…ç†æ—¥èªŒæ–‡ä»¶
journalctl --vacuum-time=7d
```

### æ•…éšœæ¢å¾©

#### è‡ªå‹•æ•…éšœæ¢å¾©è…³æœ¬
```bash
# scripts/auto_recovery.sh
#!/bin/bash

SERVICE_NAME="trading-api"
MAX_RETRIES=3
RETRY_COUNT=0

while [ $RETRY_COUNT -lt $MAX_RETRIES ]; do
    if systemctl is-active --quiet $SERVICE_NAME; then
        echo "$SERVICE_NAME é‹è¡Œæ­£å¸¸"
        exit 0
    else
        echo "$SERVICE_NAME æœªé‹è¡Œï¼Œå˜—è©¦é‡å•Ÿ..."
        systemctl restart $SERVICE_NAME
        sleep 30
        RETRY_COUNT=$((RETRY_COUNT + 1))
    fi
done

echo "$SERVICE_NAME é‡å•Ÿå¤±æ•—ï¼Œéœ€è¦äººå·¥ä»‹å…¥"
# ç™¼é€å‘Šè­¦é€šçŸ¥
curl -X POST "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK" \
     -H 'Content-type: application/json' \
     --data "{\"text\":\"CRITICAL: $SERVICE_NAME æœå‹™ç„¡æ³•å•Ÿå‹•\"}"

exit 1
```

#### è³‡æ–™æ¢å¾©ç¨‹åº
```bash
# scripts/restore_backup.sh
#!/bin/bash

BACKUP_DATE=$1
BACKUP_DIR="/backup/trading-system"

if [ -z "$BACKUP_DATE" ]; then
    echo "ä½¿ç”¨æ–¹æ³•: $0 <backup_date>"
    echo "ç¯„ä¾‹: $0 20241219_020000"
    exit 1
fi

echo "é–‹å§‹æ¢å¾©å‚™ä»½: $BACKUP_DATE"

# åœæ­¢æœå‹™
systemctl stop trading-api trading-web

# æ¢å¾©è³‡æ–™åº«
psql -h localhost -U postgres -c "DROP DATABASE IF EXISTS trading_system;"
psql -h localhost -U postgres -c "CREATE DATABASE trading_system;"
psql -h localhost -U trading_user trading_system < $BACKUP_DIR/db_backup_$BACKUP_DATE.sql

# æ¢å¾©æ•¸æ“šæ–‡ä»¶
tar -xzf $BACKUP_DIR/data_backup_$BACKUP_DATE.tar.gz -C /

# å•Ÿå‹•æœå‹™
systemctl start trading-api trading-web

# é©—è­‰æ¢å¾©
sleep 10
curl -f http://localhost:8000/api/health || echo "å¥åº·æª¢æŸ¥å¤±æ•—"

echo "å‚™ä»½æ¢å¾©å®Œæˆ"
```

### æ•ˆèƒ½èª¿å„ª

#### ç³»çµ±åƒæ•¸å„ªåŒ–
```bash
# /etc/sysctl.conf
# ç¶²è·¯å„ªåŒ–
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 65536 16777216

# æª”æ¡ˆæè¿°ç¬¦é™åˆ¶
fs.file-max = 65536

# è¨˜æ†¶é«”ç®¡ç†
vm.swappiness = 10
vm.dirty_ratio = 15
vm.dirty_background_ratio = 5
```

#### è³‡æ–™åº«èª¿å„ª
```sql
-- PostgreSQL é…ç½®å„ªåŒ–
-- postgresql.conf

-- è¨˜æ†¶é«”è¨­å®š
shared_buffers = 256MB
effective_cache_size = 1GB
work_mem = 4MB
maintenance_work_mem = 64MB

-- é€£æ¥è¨­å®š
max_connections = 100
shared_preload_libraries = 'pg_stat_statements'

-- æ—¥èªŒè¨­å®š
log_statement = 'mod'
log_min_duration_statement = 1000
```

---

## ğŸ“ æŠ€è¡“æ”¯æ´

### æ”¯æ´è¯ç¹«
- **é‹ç¶­åœ˜éšŠ**ï¼šops@trading-system.com
- **ç·Šæ€¥æ”¯æ´**ï¼š+886-2-1234-5678
- **æŠ€è¡“æ–‡æª”**ï¼šhttps://docs.trading-system.com
- **ç›£æ§å„€è¡¨æ¿**ï¼šhttps://monitoring.trading-system.com

### æ•…éšœå ±å‘Š
ç•¶é‡åˆ°å•é¡Œæ™‚ï¼Œè«‹æä¾›ä»¥ä¸‹è³‡è¨Šï¼š
1. å•é¡Œæè¿°å’Œé‡ç¾æ­¥é©Ÿ
2. éŒ¯èª¤è¨Šæ¯å’Œæ—¥èªŒ
3. ç³»çµ±ç’°å¢ƒè³‡è¨Š
4. ç™¼ç”Ÿæ™‚é–“å’Œå½±éŸ¿ç¯„åœ

---

## ğŸ“ æ–‡æª”è³‡è¨Š

**æ–‡æª”ç‰ˆæœ¬**ï¼š1.0
**æœ€å¾Œæ›´æ–°**ï¼š2024å¹´12æœˆ
**é è¨ˆé–±è®€æ™‚é–“**ï¼š45åˆ†é˜
**ç›®æ¨™ç”¨æˆ¶**ï¼šç³»çµ±ç®¡ç†å“¡ã€DevOps å·¥ç¨‹å¸«
**ç¶­è­·åœ˜éšŠ**ï¼šé‹ç¶­åœ˜éšŠ
