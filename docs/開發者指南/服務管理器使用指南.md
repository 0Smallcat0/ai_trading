# æœå‹™ç®¡ç†å™¨ä½¿ç”¨æŒ‡å—

**ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-01-27  
**é©ç”¨ç¯„åœ**: AI Trading System å°ˆæ¡ˆ

---

## ğŸ“‹ æ¦‚è¿°

æœ¬å°ˆæ¡ˆåŒ…å«å¤šå€‹æœå‹™ç®¡ç†å™¨ï¼Œæ¯å€‹éƒ½æœ‰ç‰¹å®šçš„è·è²¬ç¯„åœã€‚æœ¬æŒ‡å—æ˜ç¢ºå„ç®¡ç†å™¨çš„åˆ†å·¥ï¼Œå¹«åŠ©é–‹ç™¼è€…é¸æ“‡æ­£ç¢ºçš„æœå‹™ç®¡ç†å·¥å…·ã€‚

---

## ğŸ—ï¸ å„ç®¡ç†å™¨è·è²¬åˆ†å·¥

### 1. ServiceManager - é€šç”¨æœå‹™ç®¡ç†å™¨

**æª”æ¡ˆä½ç½®**: `src/core/services/service_manager.py`  
**ä¸»è¦è·è²¬**: ç®¡ç†ç³»çµ±ä¸­æ‰€æœ‰æœå‹™çš„ç”Ÿå‘½é€±æœŸ

**è² è²¬ç¯„åœ**:
- æœå‹™è¨»å†Šèˆ‡ç™¼ç¾ (`register_service()`, `get_service()`)
- æœå‹™ç”Ÿå‘½é€±æœŸç®¡ç† (`start_service()`, `stop_service()`)
- æœå‹™å¥åº·ç›£æ§ (`start_monitoring()`, `get_health()`)
- æœå‹™ä¾è³´ç®¡ç† (`add_dependency()`)
- ç³»çµ±æ•´é«”ç‹€æ…‹ç›£æ§ (`get_system_status()`)

**ä½¿ç”¨å ´æ™¯**:
- ç³»çµ±å•Ÿå‹•æ™‚è¨»å†Šæ ¸å¿ƒæœå‹™
- ç®¡ç†æœå‹™é–“çš„ä¾è³´é—œä¿‚
- ç›£æ§ç³»çµ±æ•´é«”å¥åº·ç‹€æ…‹
- çµ±ä¸€çš„æœå‹™ç”Ÿå‘½é€±æœŸæ§åˆ¶

### 2. PortfolioService - æŠ•è³‡çµ„åˆæœå‹™ç®¡ç†

**æª”æ¡ˆä½ç½®**: `src/services/portfolio_service/__init__.py`  
**ä¸»è¦è·è²¬**: ç®¡ç†æŠ•è³‡çµ„åˆç›¸é—œçš„å°ˆé–€æœå‹™

**è² è²¬ç¯„åœ**:
- æŠ•è³‡çµ„åˆæ ¸å¿ƒæœå‹™ (`core`)
- æŠ•è³‡çµ„åˆæœ€ä½³åŒ–æœå‹™ (`optimization`)
- é¢¨éšªåˆ†ææœå‹™ (`risk_analysis`)
- è³‡æ–™åº«æ“ä½œæœå‹™ (`database`)

**ä½¿ç”¨å ´æ™¯**:
- æŠ•è³‡çµ„åˆçš„ CRUD æ“ä½œ
- æŠ•è³‡çµ„åˆæœ€ä½³åŒ–è¨ˆç®—
- é¢¨éšªåˆ†æå’Œè©•ä¼°
- æŠ•è³‡çµ„åˆè³‡æ–™æŒä¹…åŒ–

### 3. MockBackendServices - æ¨¡æ“¬å¾Œç«¯æœå‹™ç®¡ç†

**æª”æ¡ˆä½ç½®**: `src/ui/mock_backend_services.py`  
**ä¸»è¦è·è²¬**: æä¾›é–‹ç™¼å’Œæ¸¬è©¦éšæ®µçš„æ¨¡æ“¬æœå‹™

**è² è²¬ç¯„åœ**:
- æ¨¡æ“¬è³‡æ–™ç®¡ç†æœå‹™ (`MockDataManagementService`)
- æ¨¡æ“¬å›æ¸¬æœå‹™ (`MockBacktestService`)
- æ¨¡æ“¬æŠ•è³‡çµ„åˆæœå‹™ (`MockPortfolioService`)
- æ¨¡æ“¬é¢¨éšªç®¡ç†æœå‹™ (`MockRiskManagementService`)
- æ¨¡æ“¬ç­–ç•¥ç®¡ç†æœå‹™ (`MockStrategyManagementService`)
- æ¨¡æ“¬ç³»çµ±ç›£æ§æœå‹™ (`MockSystemMonitoringService`)
- æ¨¡æ“¬AIæ¨¡å‹æœå‹™ (`MockAIModelManagementService`)

**ä½¿ç”¨å ´æ™¯**:
- å‰ç«¯é–‹ç™¼éšæ®µçš„å¾Œç«¯æœå‹™æ¨¡æ“¬
- å–®å…ƒæ¸¬è©¦å’Œæ•´åˆæ¸¬è©¦
- æ¼”ç¤ºå’ŒåŸå‹é–‹ç™¼
- é›¢ç·šé–‹ç™¼ç’°å¢ƒ

---

## ğŸ’¡ ä½¿ç”¨ç¯„ä¾‹

### ServiceManager ç¯„ä¾‹

```python
from src.core.services.service_manager import ServiceManager

# ç²å–æœå‹™ç®¡ç†å™¨å¯¦ä¾‹
manager = ServiceManager()

# è¨»å†Šè‡ªå®šç¾©æœå‹™
from src.core.services.base_service import BaseService

class MyService(BaseService):
    def __init__(self):
        super().__init__("my_service", "1.0.0")
    
    def start(self):
        self.status = ServiceStatus.RUNNING
        return True

# è¨»å†Šä¸¦å•Ÿå‹•æœå‹™
service = MyService()
manager.register_service(service)
manager.start_service("my_service")

# ç²å–ç³»çµ±ç‹€æ…‹
status = manager.get_system_status()
print(f"ç³»çµ±å¥åº·ç‹€æ…‹: {status['system_healthy']}")
```

### PortfolioService ç¯„ä¾‹

```python
from src.services.portfolio_service import PortfolioService

# åˆå§‹åŒ–æŠ•è³‡çµ„åˆæœå‹™
portfolio_service = PortfolioService()

# å‰µå»ºæŠ•è³‡çµ„åˆ
portfolio_id = portfolio_service.create_portfolio(
    name="æˆ‘çš„æŠ•è³‡çµ„åˆ",
    description="é•·æœŸæŠ•è³‡çµ„åˆ",
    holdings=[
        {"symbol": "2330.TW", "quantity": 100, "price": 500},
        {"symbol": "2317.TW", "quantity": 200, "price": 100}
    ]
)

# ç²å–æŠ•è³‡çµ„åˆç¸¾æ•ˆ
performance = portfolio_service.get_performance_metrics(portfolio_id)
print(f"ç¸½åƒ¹å€¼: {performance['total_value']}")

# é€²è¡ŒæŠ•è³‡çµ„åˆæœ€ä½³åŒ–
optimization_result = portfolio_service.optimize_portfolio(
    portfolio_id, 
    method="mean_variance"
)
```

### MockBackendServices ç¯„ä¾‹

```python
from src.ui.mock_backend_services import get_mock_service

# ç²å–æ¨¡æ“¬è³‡æ–™ç®¡ç†æœå‹™
data_service = get_mock_service("data_management")

# æ¨¡æ“¬è³‡æ–™æ›´æ–°
update_result = data_service.update_data(["price", "volume"])
print(f"æ›´æ–°çµæœ: {update_result['message']}")

# ç²å–æ¨¡æ“¬è‚¡ç¥¨è³‡æ–™
stock_data = data_service.get_stock_data("2330.TW")
print(f"è‚¡åƒ¹: {stock_data['price']}")

# ç²å–æ¨¡æ“¬å›æ¸¬æœå‹™
backtest_service = get_mock_service("backtest")

# åŸ·è¡Œæ¨¡æ“¬å›æ¸¬
backtest_result = backtest_service.run_backtest({
    "strategy": "moving_average",
    "start_date": "2024-01-01",
    "end_date": "2024-12-31"
})
print(f"å¹´åŒ–å ±é…¬ç‡: {backtest_result['results']['annual_return']}%")
```

---

## ğŸ¯ æ±ºç­–æŒ‡å—

### ä½•æ™‚ä½¿ç”¨å“ªå€‹ç®¡ç†å™¨ï¼Ÿ

```
éœ€è¦ç®¡ç†ä»€éº¼ï¼Ÿ
â”œâ”€â”€ ç³»çµ±ç´šæœå‹™ç®¡ç†
â”‚   â”œâ”€â”€ æœå‹™è¨»å†Šèˆ‡ç™¼ç¾ â†’ ServiceManager
â”‚   â”œâ”€â”€ æœå‹™ç”Ÿå‘½é€±æœŸç®¡ç† â†’ ServiceManager
â”‚   â”œâ”€â”€ æœå‹™å¥åº·ç›£æ§ â†’ ServiceManager
â”‚   â””â”€â”€ æœå‹™ä¾è³´ç®¡ç† â†’ ServiceManager
â”œâ”€â”€ æŠ•è³‡çµ„åˆå°ˆé–€æœå‹™
â”‚   â”œâ”€â”€ æŠ•è³‡çµ„åˆ CRUD â†’ PortfolioService
â”‚   â”œâ”€â”€ æŠ•è³‡çµ„åˆæœ€ä½³åŒ– â†’ PortfolioService
â”‚   â”œâ”€â”€ é¢¨éšªåˆ†æ â†’ PortfolioService
â”‚   â””â”€â”€ æŠ•è³‡çµ„åˆè³‡æ–™åº« â†’ PortfolioService
â””â”€â”€ é–‹ç™¼æ¸¬è©¦æ¨¡æ“¬
    â”œâ”€â”€ å‰ç«¯é–‹ç™¼æ¨¡æ“¬ â†’ MockBackendServices
    â”œâ”€â”€ å–®å…ƒæ¸¬è©¦ â†’ MockBackendServices
    â”œâ”€â”€ æ¼”ç¤ºåŸå‹ â†’ MockBackendServices
    â””â”€â”€ é›¢ç·šé–‹ç™¼ â†’ MockBackendServices
```

### æ±ºç­–æµç¨‹åœ–ï¼ˆæ–‡å­—ç‰ˆï¼‰

1. **å•é¡Œ**: æˆ‘éœ€è¦ç®¡ç†ä»€éº¼æœå‹™ï¼Ÿ
2. **ç³»çµ±ç´šæœå‹™ç®¡ç†**ï¼Ÿ
   - æ˜¯ â†’ ä½¿ç”¨ `ServiceManager`
   - å¦ â†’ ç¹¼çºŒ
3. **æŠ•è³‡çµ„åˆå°ˆé–€åŠŸèƒ½**ï¼Ÿ
   - æ˜¯ â†’ ä½¿ç”¨ `PortfolioService`
   - å¦ â†’ ç¹¼çºŒ
4. **é–‹ç™¼æ¸¬è©¦éšæ®µ**ï¼Ÿ
   - æ˜¯ â†’ ä½¿ç”¨ `MockBackendServices`
   - å¦ â†’ æª¢æŸ¥æ˜¯å¦éœ€è¦æ–°çš„æœå‹™ç®¡ç†å™¨

---

## ğŸ“š æœ€ä½³å¯¦è¸

### 1. æœå‹™åˆ†é›¢åŸå‰‡
- ä¸åŒè·è²¬çš„æœå‹™ä½¿ç”¨ä¸åŒçš„ç®¡ç†å™¨
- é¿å…åœ¨ä¸€å€‹ç®¡ç†å™¨ä¸­æ··åˆå¤šç¨®é¡å‹çš„æœå‹™
- ä¿æŒæœå‹™çš„å–®ä¸€è·è²¬åŸå‰‡

### 2. æœå‹™è¨»å†Š
```python
# å¥½çš„åšæ³•ï¼šä½¿ç”¨é©ç•¶çš„ç®¡ç†å™¨
# ç³»çµ±ç´šæœå‹™
service_manager.register_service(auth_service)

# æŠ•è³‡çµ„åˆæœå‹™
portfolio_service = PortfolioService()

# é¿å…ï¼šæ··åˆä½¿ç”¨
service_manager.register_service(portfolio_service)  # ä¸å»ºè­°
```

### 3. ä¾è³´ç®¡ç†
```python
# å¥½çš„åšæ³•ï¼šæ˜ç¢ºä¾è³´é—œä¿‚
service_manager.add_dependency("trading_service", "auth_service")
service_manager.add_dependency("portfolio_service", "data_service")

# é¿å…ï¼šå¾ªç’°ä¾è³´
service_manager.add_dependency("service_a", "service_b")
service_manager.add_dependency("service_b", "service_a")  # æœƒå°è‡´å•é¡Œ
```

### 4. éŒ¯èª¤è™•ç†
```python
# å¥½çš„åšæ³•ï¼šå„ªé›…çš„éŒ¯èª¤è™•ç†
try:
    service = service_manager.get_service("my_service")
    if service is None:
        logger.warning("æœå‹™ä¸å­˜åœ¨ï¼Œä½¿ç”¨é è¨­å¯¦ç¾")
        service = DefaultService()
except Exception as e:
    logger.error(f"ç²å–æœå‹™å¤±æ•—: {e}")
```

### 5. ç”Ÿå‘½é€±æœŸç®¡ç†
```python
# å¥½çš„åšæ³•ï¼šçµ±ä¸€çš„ç”Ÿå‘½é€±æœŸç®¡ç†
def startup():
    service_manager.start_all_services()
    service_manager.start_monitoring()

def shutdown():
    service_manager.stop_monitoring()
    service_manager.stop_all_services()
```

---

## ğŸ”— äº¤å‰å¼•ç”¨

å„æœå‹™ç®¡ç†å™¨æª”æ¡ˆé ‚éƒ¨å·²æ·»åŠ äº¤å‰å¼•ç”¨è¨»é‡‹ï¼š

```python
# æœå‹™ç®¡ç†å™¨è·è²¬åˆ†å·¥ï¼š
# - ServiceManager: é€šç”¨æœå‹™ç®¡ç†å™¨ (src/core/services/service_manager.py)
# - PortfolioService: æŠ•è³‡çµ„åˆæœå‹™ç®¡ç† (src/services/portfolio_service/__init__.py)
# - MockBackendServices: æ¨¡æ“¬å¾Œç«¯æœå‹™ç®¡ç† (src/ui/mock_backend_services.py)
# è©³è¦‹ï¼šdocs/é–‹ç™¼è€…æŒ‡å—/æœå‹™ç®¡ç†å™¨ä½¿ç”¨æŒ‡å—.md
```

---

## ğŸ“ æ”¯æ´

å¦‚æœ‰æœå‹™ç®¡ç†ç›¸é—œå•é¡Œï¼Œè«‹ï¼š
1. æŸ¥é–±æœ¬æŒ‡å—
2. æª¢æŸ¥ç›¸é—œæœå‹™ç®¡ç†å™¨çš„ docstring
3. åƒè€ƒä½¿ç”¨ç¯„ä¾‹
4. è¯ç¹«é–‹ç™¼åœ˜éšŠ

**æœ€å¾Œæ›´æ–°**: 2025-01-27  
**ç¶­è­·è€…**: AI Trading System é–‹ç™¼åœ˜éšŠ
