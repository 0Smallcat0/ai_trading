# éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—è©³ç´°èªªæ˜ AI è‚¡ç¥¨è‡ªå‹•äº¤æ˜“ç³»çµ±çš„éƒ¨ç½²æµç¨‹ï¼ŒåŒ…æ‹¬ç’°å¢ƒè¨­ç½®ã€é…ç½®ç®¡ç†ã€éƒ¨ç½²æ­¥é©Ÿå’Œå¸¸è¦‹å•é¡Œè§£æ±ºæ–¹æ¡ˆã€‚

## ğŸ“š ç›®éŒ„

1. [éƒ¨ç½²æ¦‚è¦½](#éƒ¨ç½²æ¦‚è¦½)
2. [ç’°å¢ƒæº–å‚™](#ç’°å¢ƒæº–å‚™)
3. [æœ¬åœ°éƒ¨ç½²](#æœ¬åœ°éƒ¨ç½²)
4. [Docker éƒ¨ç½²](#docker-éƒ¨ç½²)
5. [ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²](#ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²)
6. [é…ç½®ç®¡ç†](#é…ç½®ç®¡ç†)
7. [ç›£æ§èˆ‡ç¶­è­·](#ç›£æ§èˆ‡ç¶­è­·)
8. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## ğŸŒ éƒ¨ç½²æ¦‚è¦½

### ç³»çµ±æ¶æ§‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è² è¼‰å‡è¡¡å™¨     â”‚    â”‚   Web æ‡‰ç”¨      â”‚    â”‚   API æœå‹™      â”‚
â”‚   (Nginx)       â”‚â—„â”€â”€â–ºâ”‚   (Streamlit)   â”‚â—„â”€â”€â–ºâ”‚   (FastAPI)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                        â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   è³‡æ–™åº«        â”‚    â”‚   ç›£æ§ç³»çµ±      â”‚
                       â”‚   (PostgreSQL)  â”‚    â”‚   (Prometheus)  â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éƒ¨ç½²é¸é …

#### 1. æœ¬åœ°é–‹ç™¼éƒ¨ç½²
- **é©ç”¨å ´æ™¯**ï¼šé–‹ç™¼å’Œæ¸¬è©¦
- **è³‡æºéœ€æ±‚**ï¼š4GB RAM, 2 CPU æ ¸å¿ƒ
- **éƒ¨ç½²æ™‚é–“**ï¼š10-15 åˆ†é˜

#### 2. Docker å®¹å™¨éƒ¨ç½²
- **é©ç”¨å ´æ™¯**ï¼šæ¸¬è©¦å’Œå°è¦æ¨¡ç”Ÿç”¢
- **è³‡æºéœ€æ±‚**ï¼š8GB RAM, 4 CPU æ ¸å¿ƒ
- **éƒ¨ç½²æ™‚é–“**ï¼š15-20 åˆ†é˜

#### 3. Kubernetes é›†ç¾¤éƒ¨ç½²
- **é©ç”¨å ´æ™¯**ï¼šå¤§è¦æ¨¡ç”Ÿç”¢ç’°å¢ƒ
- **è³‡æºéœ€æ±‚**ï¼š16GB+ RAM, 8+ CPU æ ¸å¿ƒ
- **éƒ¨ç½²æ™‚é–“**ï¼š30-45 åˆ†é˜

### ç³»çµ±è¦æ±‚

#### æœ€ä½è¦æ±‚
```
ä½œæ¥­ç³»çµ±: Ubuntu 20.04+ / CentOS 8+ / Windows 10+
CPU: 2 æ ¸å¿ƒ
è¨˜æ†¶é«”: 4GB RAM
å„²å­˜: 20GB å¯ç”¨ç©ºé–“
ç¶²è·¯: ç©©å®šçš„ç¶²éš›ç¶²è·¯é€£æ¥
```

#### æ¨è–¦é…ç½®
```
ä½œæ¥­ç³»çµ±: Ubuntu 22.04 LTS
CPU: 4+ æ ¸å¿ƒ
è¨˜æ†¶é«”: 8GB+ RAM
å„²å­˜: 50GB+ SSD
ç¶²è·¯: 100Mbps+ é »å¯¬
```

## ğŸ”§ ç’°å¢ƒæº–å‚™

### 1. åŸºç¤è»Ÿé«”å®‰è£

#### Ubuntu/Debian
```bash
# æ›´æ–°ç³»çµ±
sudo apt update && sudo apt upgrade -y

# å®‰è£åŸºç¤å·¥å…·
sudo apt install -y curl wget git vim htop

# å®‰è£ Python 3.9+
sudo apt install -y python3.9 python3.9-pip python3.9-venv

# å®‰è£ Poetry
curl -sSL https://install.python-poetry.org | python3 -

# å®‰è£ Docker (å¯é¸)
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# å®‰è£ Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

#### CentOS/RHEL
```bash
# æ›´æ–°ç³»çµ±
sudo yum update -y

# å®‰è£åŸºç¤å·¥å…·
sudo yum install -y curl wget git vim htop

# å®‰è£ Python 3.9+
sudo yum install -y python39 python39-pip

# å®‰è£ Poetry
curl -sSL https://install.python-poetry.org | python3 -
```

### 2. è³‡æ–™åº«å®‰è£

#### PostgreSQL å®‰è£
```bash
# Ubuntu
sudo apt install -y postgresql postgresql-contrib

# CentOS
sudo yum install -y postgresql-server postgresql-contrib

# åˆå§‹åŒ–è³‡æ–™åº«
sudo postgresql-setup initdb

# å•Ÿå‹•æœå‹™
sudo systemctl start postgresql
sudo systemctl enable postgresql

# å‰µå»ºè³‡æ–™åº«å’Œç”¨æˆ¶
sudo -u postgres psql
CREATE DATABASE ai_trading;
CREATE USER ai_trading_user WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE ai_trading TO ai_trading_user;
\q
```

#### Redis å®‰è£ (å¯é¸)
```bash
# Ubuntu
sudo apt install -y redis-server

# CentOS
sudo yum install -y redis

# å•Ÿå‹•æœå‹™
sudo systemctl start redis
sudo systemctl enable redis
```

## ğŸ  æœ¬åœ°éƒ¨ç½²

### 1. ç²å–æºç¢¼
```bash
# å…‹éš†å€‰åº«
git clone https://github.com/Cookieeeeeeeeeeeeeee/ai_trading.git
cd ai_trading

# åˆ‡æ›åˆ°ç©©å®šç‰ˆæœ¬
git checkout main
```

### 2. ç’°å¢ƒé…ç½®
```bash
# è¤‡è£½ç’°å¢ƒé…ç½®æª”æ¡ˆ
cp .env.example .env

# ç·¨è¼¯é…ç½®æª”æ¡ˆ
vim .env
```

#### ç’°å¢ƒè®Šæ•¸é…ç½®
```bash
# .env æª”æ¡ˆå…§å®¹
# è³‡æ–™åº«é…ç½®
DATABASE_URL=postgresql://ai_trading_user:your_password@localhost:5432/ai_trading

# Redis é…ç½® (å¯é¸)
REDIS_URL=redis://localhost:6379/0

# å®‰å…¨é…ç½®
SECRET_KEY=your_secret_key_here
JWT_SECRET_KEY=your_jwt_secret_key_here

# API é…ç½®
API_HOST=0.0.0.0
API_PORT=8000

# Streamlit é…ç½®
STREAMLIT_HOST=0.0.0.0
STREAMLIT_PORT=8501

# æ—¥èªŒé…ç½®
LOG_LEVEL=INFO
LOG_FILE=logs/app.log

# åˆ¸å•† API é…ç½® (æ ¹æ“šéœ€è¦é…ç½®)
SHIOAJI_API_KEY=your_shioaji_api_key
SHIOAJI_SECRET_KEY=your_shioaji_secret_key
```

### 3. å®‰è£ä¾è³´
```bash
# ä½¿ç”¨ Poetry å®‰è£
poetry install

# æˆ–ä½¿ç”¨ pip å®‰è£
pip install -r requirements.txt
```

### 4. è³‡æ–™åº«åˆå§‹åŒ–
```bash
# åŸ·è¡Œè³‡æ–™åº«é·ç§»
poetry run alembic upgrade head

# æˆ–ç›´æ¥åŸ·è¡Œåˆå§‹åŒ–è…³æœ¬
poetry run python scripts/init_database.py
```

### 5. å•Ÿå‹•æœå‹™
```bash
# å•Ÿå‹• API æœå‹™
poetry run uvicorn src.api.main:app --host 0.0.0.0 --port 8000 &

# å•Ÿå‹• Web UI
poetry run streamlit run src/ui/web_ui.py --server.address=0.0.0.0 --server.port=8501 &

# æª¢æŸ¥æœå‹™ç‹€æ…‹
curl http://localhost:8000/health
curl http://localhost:8501
```

## ğŸ³ Docker éƒ¨ç½²

### 1. Docker Compose éƒ¨ç½² (æ¨è–¦)

#### docker-compose.yml
```yaml
version: '3.8'

services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: ai_trading
      POSTGRES_USER: ai_trading_user
      POSTGRES_PASSWORD: your_password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ai_trading_user -d ai_trading"]
      interval: 30s
      timeout: 10s
      retries: 3

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  api:
    build:
      context: .
      dockerfile: Dockerfile.api
    environment:
      - DATABASE_URL=postgresql://ai_trading_user:your_password@postgres:5432/ai_trading
      - REDIS_URL=redis://redis:6379/0
    ports:
      - "8000:8000"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_started
    volumes:
      - ./logs:/app/logs

  web:
    build:
      context: .
      dockerfile: Dockerfile.web
    environment:
      - API_BASE_URL=http://api:8000
    ports:
      - "8501:8501"
    depends_on:
      - api

volumes:
  postgres_data:
  redis_data:
```

#### Dockerfile.api
```dockerfile
FROM python:3.9-slim

WORKDIR /app

# å®‰è£ç³»çµ±ä¾è³´
RUN apt-get update && apt-get install -y \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# è¤‡è£½ä¾è³´æª”æ¡ˆ
COPY pyproject.toml poetry.lock ./

# å®‰è£ Poetry å’Œä¾è³´
RUN pip install poetry && \
    poetry config virtualenvs.create false && \
    poetry install --no-dev

# è¤‡è£½æ‡‰ç”¨ä»£ç¢¼
COPY src/ ./src/
COPY scripts/ ./scripts/
COPY alembic/ ./alembic/
COPY alembic.ini ./

# å‰µå»ºæ—¥èªŒç›®éŒ„
RUN mkdir -p logs

# æš´éœ²ç«¯å£
EXPOSE 8000

# å•Ÿå‹•å‘½ä»¤
CMD ["uvicorn", "src.api.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

#### Dockerfile.web
```dockerfile
FROM python:3.9-slim

WORKDIR /app

# å®‰è£ç³»çµ±ä¾è³´
RUN apt-get update && apt-get install -y \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# è¤‡è£½ä¾è³´æª”æ¡ˆ
COPY pyproject.toml poetry.lock ./

# å®‰è£ Poetry å’Œä¾è³´
RUN pip install poetry && \
    poetry config virtualenvs.create false && \
    poetry install --no-dev

# è¤‡è£½æ‡‰ç”¨ä»£ç¢¼
COPY src/ ./src/

# æš´éœ²ç«¯å£
EXPOSE 8501

# å•Ÿå‹•å‘½ä»¤
CMD ["streamlit", "run", "src/ui/web_ui.py", "--server.address=0.0.0.0", "--server.port=8501"]
```

### 2. å•Ÿå‹• Docker éƒ¨ç½²
```bash
# æ§‹å»ºå’Œå•Ÿå‹•æœå‹™
docker-compose up -d

# æª¢æŸ¥æœå‹™ç‹€æ…‹
docker-compose ps

# æŸ¥çœ‹æ—¥èªŒ
docker-compose logs -f

# åŸ·è¡Œè³‡æ–™åº«é·ç§»
docker-compose exec api alembic upgrade head
```

## â˜ï¸ ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²

### 1. Kubernetes éƒ¨ç½²

#### namespace.yaml
```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: ai-trading
```

#### configmap.yaml
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: ai-trading-config
  namespace: ai-trading
data:
  DATABASE_URL: "postgresql://ai_trading_user:password@postgres:5432/ai_trading"
  REDIS_URL: "redis://redis:6379/0"
  LOG_LEVEL: "INFO"
```

#### deployment.yaml
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ai-trading-api
  namespace: ai-trading
spec:
  replicas: 3
  selector:
    matchLabels:
      app: ai-trading-api
  template:
    metadata:
      labels:
        app: ai-trading-api
    spec:
      containers:
      - name: api
        image: ai-trading:latest
        ports:
        - containerPort: 8000
        envFrom:
        - configMapRef:
            name: ai-trading-config
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 5
          periodSeconds: 5
```

#### service.yaml
```yaml
apiVersion: v1
kind: Service
metadata:
  name: ai-trading-api-service
  namespace: ai-trading
spec:
  selector:
    app: ai-trading-api
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8000
  type: ClusterIP
```

### 2. éƒ¨ç½²åˆ° Kubernetes
```bash
# æ‡‰ç”¨é…ç½®
kubectl apply -f k8s/namespace.yaml
kubectl apply -f k8s/configmap.yaml
kubectl apply -f k8s/deployment.yaml
kubectl apply -f k8s/service.yaml

# æª¢æŸ¥éƒ¨ç½²ç‹€æ…‹
kubectl get pods -n ai-trading
kubectl get services -n ai-trading

# æŸ¥çœ‹æ—¥èªŒ
kubectl logs -f deployment/ai-trading-api -n ai-trading
```

## âš™ï¸ é…ç½®ç®¡ç†

### 1. ç’°å¢ƒè®Šæ•¸ç®¡ç†
```bash
# é–‹ç™¼ç’°å¢ƒ
export ENVIRONMENT=development
export DEBUG=true

# æ¸¬è©¦ç’°å¢ƒ
export ENVIRONMENT=testing
export DEBUG=false

# ç”Ÿç”¢ç’°å¢ƒ
export ENVIRONMENT=production
export DEBUG=false
```

### 2. é…ç½®æª”æ¡ˆç®¡ç†
```python
# config/settings.py
import os
from pydantic import BaseSettings

class Settings(BaseSettings):
    environment: str = os.getenv("ENVIRONMENT", "development")
    debug: bool = os.getenv("DEBUG", "false").lower() == "true"
    
    database_url: str
    redis_url: str = None
    
    secret_key: str
    jwt_secret_key: str
    
    api_host: str = "0.0.0.0"
    api_port: int = 8000
    
    class Config:
        env_file = ".env"

settings = Settings()
```

### 3. å¯†é‘°ç®¡ç†
```bash
# ä½¿ç”¨ Kubernetes Secrets
kubectl create secret generic ai-trading-secrets \
  --from-literal=database-password=your_password \
  --from-literal=jwt-secret=your_jwt_secret \
  -n ai-trading
```

## ğŸ“Š ç›£æ§èˆ‡ç¶­è­·

### 1. å¥åº·æª¢æŸ¥
```python
# src/api/health.py
from fastapi import APIRouter
from sqlalchemy import text
from src.database import engine

router = APIRouter()

@router.get("/health")
async def health_check():
    try:
        # æª¢æŸ¥è³‡æ–™åº«é€£æ¥
        with engine.connect() as conn:
            conn.execute(text("SELECT 1"))
        
        return {
            "status": "healthy",
            "database": "connected",
            "timestamp": datetime.utcnow()
        }
    except Exception as e:
        return {
            "status": "unhealthy",
            "error": str(e),
            "timestamp": datetime.utcnow()
        }
```

### 2. æ—¥èªŒç®¡ç†
```python
# æ—¥èªŒé…ç½®
import logging
from logging.handlers import RotatingFileHandler

def setup_logging():
    logging.basicConfig(
        level=logging.INFO,
        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
        handlers=[
            RotatingFileHandler(
                'logs/app.log',
                maxBytes=10*1024*1024,  # 10MB
                backupCount=5
            ),
            logging.StreamHandler()
        ]
    )
```

### 3. æ€§èƒ½ç›£æ§
```bash
# ä½¿ç”¨ Prometheus ç›£æ§
# prometheus.yml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'ai-trading-api'
    static_configs:
      - targets: ['localhost:8000']
    metrics_path: '/metrics'
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. æœå‹™ç„¡æ³•å•Ÿå‹•
```bash
# æª¢æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep :8000

# æª¢æŸ¥æ—¥èªŒ
tail -f logs/app.log

# æª¢æŸ¥é…ç½®
python -c "from src.config import settings; print(settings.dict())"
```

#### 2. è³‡æ–™åº«é€£æ¥å¤±æ•—
```bash
# æ¸¬è©¦è³‡æ–™åº«é€£æ¥
psql -h localhost -U ai_trading_user -d ai_trading

# æª¢æŸ¥è³‡æ–™åº«æœå‹™
sudo systemctl status postgresql
```

#### 3. Docker å®¹å™¨å•é¡Œ
```bash
# æª¢æŸ¥å®¹å™¨ç‹€æ…‹
docker-compose ps

# æŸ¥çœ‹å®¹å™¨æ—¥èªŒ
docker-compose logs api

# é‡å•Ÿæœå‹™
docker-compose restart api
```

### æ€§èƒ½èª¿å„ª

#### 1. è³‡æ–™åº«å„ªåŒ–
```sql
-- å‰µå»ºç´¢å¼•
CREATE INDEX idx_strategies_user_id ON strategies(user_id);
CREATE INDEX idx_backtest_results_strategy_id ON backtest_results(strategy_id);

-- åˆ†ææŸ¥è©¢æ€§èƒ½
EXPLAIN ANALYZE SELECT * FROM strategies WHERE user_id = 1;
```

#### 2. æ‡‰ç”¨å„ªåŒ–
```python
# ä½¿ç”¨é€£æ¥æ± 
from sqlalchemy.pool import QueuePool

engine = create_engine(
    DATABASE_URL,
    poolclass=QueuePool,
    pool_size=20,
    max_overflow=30
)
```

---

**ç‰ˆæœ¬**: v1.0.0  
**æ›´æ–°æ—¥æœŸ**: 2025å¹´1æœˆ13æ—¥  
**éƒ¨ç½²è¤‡é›œåº¦**: ğŸŸ¡ ä¸­ç­‰  

**è®Šæ›´æ­·å²**:
- v1.0.0 (2025-01-13): åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæ•´éƒ¨ç½²æŒ‡å—

**ç›¸é—œæ–‡æª”**:
- [ç³»çµ±æ¶æ§‹èªªæ˜](ç³»çµ±æ¶æ§‹èªªæ˜.md)
- [APIä½¿ç”¨æŒ‡å—](APIä½¿ç”¨æŒ‡å—.md)
- [ä»£ç¢¼è²¢ç»æŒ‡å—](ä»£ç¢¼è²¢ç»æŒ‡å—.md)
