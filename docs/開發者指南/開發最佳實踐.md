# é–‹ç™¼æœ€ä½³å¯¦è¸æŒ‡å—

**ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-07-17  
**é©ç”¨å°è±¡**: é–‹ç™¼è€…ã€ç¶­è­·äººå“¡

æœ¬æ–‡æª”æä¾› AI è‚¡ç¥¨è‡ªå‹•äº¤æ˜“ç³»çµ±çš„é–‹ç™¼æœ€ä½³å¯¦è¸ï¼Œå¹«åŠ©é–‹ç™¼è€…ç·¨å¯«é«˜å“è³ªã€å¯ç¶­è­·çš„ä»£ç¢¼ã€‚

## ğŸ—ï¸ æ¨¡çµ„é¸æ“‡æŒ‡å—

### æ¨è–¦ä½¿ç”¨çš„æ¨¡çµ„

åŸºæ–¼æœ€æ–°çš„æª”æ¡ˆçµæ§‹æ•´åˆï¼Œä»¥ä¸‹æ˜¯æ¨è–¦ä½¿ç”¨çš„æ¨¡çµ„ï¼š

#### UI æ¨¡çµ„
```python
# âœ… æ¨è–¦ï¼šä¸»è¦ç”Ÿç”¢ç‰ˆæœ¬
from src.ui.web_ui_production import main

# âœ… å¯é¸ï¼šè¨­è¨ˆåŸå‹ç‰ˆæœ¬
from src.ui.web_ui_redesigned import main

# âŒ é¿å…ï¼šå·²éæ™‚ç‰ˆæœ¬
# from src.ui.web_ui_production_legacy import main
```

#### é…ç½®ç®¡ç†
```python
# âœ… æ¨è–¦ï¼šå®Œæ•´é…ç½®ç®¡ç†ç³»çµ±
from src.utils.config_manager import create_default_config_manager

# âœ… æ¨è–¦ï¼šæ ¸å¿ƒé…ç½®é©—è­‰
from src.core.config_validator import ConfigValidator

# âŒ é¿å…ï¼šç°¡å–®åŒ…è£å™¨ï¼ˆå·²éæ™‚ï¼‰
# from src.core.config_manager import parse_args
```

#### é¢¨éšªç®¡ç†
```python
# âœ… æ¨è–¦ï¼šæ¨¡çµ„åŒ–é¢¨éšªç®¡ç†ç³»çµ±
from src.risk_management.risk_manager_refactored import RiskManager
from src.risk_management.stop_loss import StopLossManager
from src.risk_management.position_sizing import PositionSizer
from src.risk_management.portfolio_risk import PortfolioRiskManager

# âŒ é¿å…ï¼šå¤§å‹å–®ä¸€æª”æ¡ˆï¼ˆå·²éæ™‚ï¼‰
# from src.core.risk_control import RiskManager
```

#### IB é©é…å™¨
```python
# âœ… æ¨è–¦ï¼šé‡æ§‹ç‰ˆæ¨¡çµ„åŒ–è¨­è¨ˆ
from src.execution.ib_adapter_refactored import IBAdapterRefactored
from src.execution.ib_adapter_core import IBCore
from src.execution.ib_adapter_orders import OrderManager

# âŒ é¿å…ï¼šåŸå§‹ç‰ˆæœ¬ï¼ˆå·²éæ™‚ï¼‰
# from src.execution.ib_adapter import IBAdapter
```

## ğŸ“ ä»£ç¢¼ç·¨å¯«è¦ç¯„

### 1. æª”æ¡ˆçµ„ç¹”

```python
"""
æ¨¡çµ„æ–‡æª”å­—ç¬¦ä¸²

æ­¤æ¨¡çµ„è² è²¬...

Example:
    >>> from module import function
    >>> result = function()
"""

# æ¨™æº–åº«å°å…¥
import os
import sys
from typing import Dict, List, Optional

# ç¬¬ä¸‰æ–¹åº«å°å…¥
import pandas as pd
import numpy as np

# æœ¬åœ°æ¨¡çµ„å°å…¥
from src.utils.logger import get_logger
from src.core.base import BaseClass

# å¸¸æ•¸å®šç¾©
DEFAULT_TIMEOUT = 30
MAX_RETRIES = 3

# é¡åˆ¥å’Œå‡½æ•¸å®šç¾©
class ExampleClass:
    """é¡åˆ¥æ–‡æª”å­—ç¬¦ä¸²"""
    pass
```

### 2. å‡½æ•¸è¨­è¨ˆ

```python
def process_data(
    data: pd.DataFrame,
    config: Dict[str, Any],
    timeout: int = DEFAULT_TIMEOUT
) -> Tuple[bool, Optional[pd.DataFrame]]:
    """è™•ç†æ•¸æ“šçš„å‡½æ•¸
    
    Args:
        data: è¼¸å…¥æ•¸æ“š
        config: é…ç½®åƒæ•¸
        timeout: è¶…æ™‚æ™‚é–“ï¼ˆç§’ï¼‰
        
    Returns:
        (æˆåŠŸæ¨™èªŒ, è™•ç†å¾Œçš„æ•¸æ“š)
        
    Raises:
        ValueError: ç•¶æ•¸æ“šæ ¼å¼ä¸æ­£ç¢ºæ™‚
        TimeoutError: ç•¶è™•ç†è¶…æ™‚æ™‚
        
    Example:
        >>> data = pd.DataFrame({'price': [100, 101, 102]})
        >>> config = {'method': 'sma', 'window': 5}
        >>> success, result = process_data(data, config)
        >>> print(success)
        True
    """
    # å‡½æ•¸å¯¦ç¾
    pass
```

### 3. é¡åˆ¥è¨­è¨ˆ

```python
class DataProcessor:
    """æ•¸æ“šè™•ç†å™¨
    
    è² è²¬è™•ç†å¸‚å ´æ•¸æ“šï¼ŒåŒ…æ‹¬æ¸…æ´—ã€è½‰æ›å’Œé©—è­‰ã€‚
    
    Attributes:
        config: è™•ç†é…ç½®
        logger: æ—¥èªŒè¨˜éŒ„å™¨
        
    Example:
        >>> processor = DataProcessor(config={'method': 'sma'})
        >>> result = processor.process(data)
    """
    
    def __init__(self, config: Dict[str, Any]) -> None:
        """åˆå§‹åŒ–æ•¸æ“šè™•ç†å™¨
        
        Args:
            config: è™•ç†é…ç½®åƒæ•¸
        """
        self.config = config
        self.logger = get_logger(__name__)
        
    def process(self, data: pd.DataFrame) -> pd.DataFrame:
        """è™•ç†æ•¸æ“š
        
        Args:
            data: è¼¸å…¥æ•¸æ“š
            
        Returns:
            è™•ç†å¾Œçš„æ•¸æ“š
        """
        try:
            # è™•ç†é‚è¼¯
            return self._apply_processing(data)
        except Exception as e:
            self.logger.error(f"æ•¸æ“šè™•ç†å¤±æ•—: {e}")
            raise
```

## ğŸ§ª æ¸¬è©¦æœ€ä½³å¯¦è¸

### 1. æ¸¬è©¦çµæ§‹

```python
"""
æ¸¬è©¦æ¨¡çµ„æ–‡æª”

æ¸¬è©¦ DataProcessor é¡åˆ¥çš„åŠŸèƒ½
"""

import pytest
import pandas as pd
from unittest.mock import Mock, patch

from src.data.processor import DataProcessor


class TestDataProcessor:
    """DataProcessor æ¸¬è©¦é¡åˆ¥"""
    
    @pytest.fixture
    def sample_data(self):
        """æ¸¬è©¦æ•¸æ“šå¤¾å…·"""
        return pd.DataFrame({
            'timestamp': pd.date_range('2023-01-01', periods=100),
            'price': range(100, 200)
        })
    
    @pytest.fixture
    def processor(self):
        """è™•ç†å™¨å¤¾å…·"""
        config = {'method': 'sma', 'window': 5}
        return DataProcessor(config)
    
    def test_process_success(self, processor, sample_data):
        """æ¸¬è©¦æˆåŠŸè™•ç†æ•¸æ“š"""
        result = processor.process(sample_data)
        
        assert isinstance(result, pd.DataFrame)
        assert len(result) > 0
        assert 'processed_price' in result.columns
    
    def test_process_empty_data(self, processor):
        """æ¸¬è©¦ç©ºæ•¸æ“šè™•ç†"""
        empty_data = pd.DataFrame()
        
        with pytest.raises(ValueError, match="æ•¸æ“šä¸èƒ½ç‚ºç©º"):
            processor.process(empty_data)
    
    @patch('src.data.processor.external_api_call')
    def test_process_with_mock(self, mock_api, processor, sample_data):
        """æ¸¬è©¦ä½¿ç”¨ Mock çš„è™•ç†"""
        mock_api.return_value = {'status': 'success'}
        
        result = processor.process(sample_data)
        
        mock_api.assert_called_once()
        assert result is not None
```

### 2. æ¸¬è©¦è¦†è“‹ç‡è¦æ±‚

- **æ ¸å¿ƒæ¨¡çµ„**: â‰¥90% è¦†è“‹ç‡
- **ä¸€èˆ¬æ¨¡çµ„**: â‰¥80% è¦†è“‹ç‡
- **å·¥å…·æ¨¡çµ„**: â‰¥70% è¦†è“‹ç‡

## ğŸ”’ å®‰å…¨é–‹ç™¼å¯¦è¸

### 1. æ•æ„Ÿè³‡è¨Šè™•ç†

```python
import os
from src.utils.encryption import encrypt_sensitive_data

# âœ… æ­£ç¢ºï¼šä½¿ç”¨ç’°å¢ƒè®Šæ•¸
API_KEY = os.getenv('BROKER_API_KEY')
if not API_KEY:
    raise ValueError("API_KEY ç’°å¢ƒè®Šæ•¸æœªè¨­ç½®")

# âœ… æ­£ç¢ºï¼šåŠ å¯†æ•æ„Ÿæ•¸æ“š
encrypted_key = encrypt_sensitive_data(API_KEY)

# âŒ éŒ¯èª¤ï¼šç¡¬ç·¨ç¢¼æ•æ„Ÿè³‡è¨Š
# API_KEY = "your-secret-key-here"
```

### 2. è¼¸å…¥é©—è­‰

```python
def validate_trading_params(params: Dict[str, Any]) -> bool:
    """é©—è­‰äº¤æ˜“åƒæ•¸
    
    Args:
        params: äº¤æ˜“åƒæ•¸
        
    Returns:
        é©—è­‰çµæœ
        
    Raises:
        ValueError: åƒæ•¸ç„¡æ•ˆæ™‚
    """
    required_fields = ['symbol', 'quantity', 'price']
    
    for field in required_fields:
        if field not in params:
            raise ValueError(f"ç¼ºå°‘å¿…è¦åƒæ•¸: {field}")
    
    if params['quantity'] <= 0:
        raise ValueError("æ•¸é‡å¿…é ˆå¤§æ–¼ 0")
    
    if params['price'] <= 0:
        raise ValueError("åƒ¹æ ¼å¿…é ˆå¤§æ–¼ 0")
    
    return True
```

## ğŸ“Š æ€§èƒ½å„ªåŒ–

### 1. æ•¸æ“šè™•ç†å„ªåŒ–

```python
# âœ… æ¨è–¦ï¼šä½¿ç”¨å‘é‡åŒ–æ“ä½œ
def calculate_sma_vectorized(data: pd.DataFrame, window: int) -> pd.Series:
    """ä½¿ç”¨å‘é‡åŒ–è¨ˆç®—ç§»å‹•å¹³å‡"""
    return data['price'].rolling(window=window).mean()

# âŒ é¿å…ï¼šä½¿ç”¨å¾ªç’°
def calculate_sma_loop(data: pd.DataFrame, window: int) -> List[float]:
    """ä½¿ç”¨å¾ªç’°è¨ˆç®—ç§»å‹•å¹³å‡ï¼ˆæ•ˆç‡ä½ï¼‰"""
    result = []
    for i in range(len(data)):
        if i >= window - 1:
            avg = data['price'].iloc[i-window+1:i+1].mean()
            result.append(avg)
        else:
            result.append(None)
    return result
```

### 2. è¨˜æ†¶é«”ç®¡ç†

```python
import gc
from contextlib import contextmanager

@contextmanager
def memory_efficient_processing():
    """è¨˜æ†¶é«”é«˜æ•ˆè™•ç†ä¸Šä¸‹æ–‡ç®¡ç†å™¨"""
    try:
        yield
    finally:
        gc.collect()  # å¼·åˆ¶åƒåœ¾å›æ”¶

# ä½¿ç”¨ç¤ºä¾‹
with memory_efficient_processing():
    large_data = load_large_dataset()
    result = process_data(large_data)
    # large_data æœƒåœ¨é›¢é–‹ä¸Šä¸‹æ–‡æ™‚è¢«æ¸…ç†
```

## ğŸ”„ ç‰ˆæœ¬æ§åˆ¶æœ€ä½³å¯¦è¸

### 1. æäº¤è¨Šæ¯è¦ç¯„

```bash
# åŠŸèƒ½æ·»åŠ 
feat: add new risk management module

# éŒ¯èª¤ä¿®å¾©
fix: resolve memory leak in data processor

# æ–‡æª”æ›´æ–°
docs: update API documentation

# é‡æ§‹
refactor: optimize trading strategy execution

# æ¸¬è©¦
test: add unit tests for portfolio manager
```

### 2. åˆ†æ”¯ç­–ç•¥

```bash
# ä¸»åˆ†æ”¯
main                    # ç”Ÿç”¢ç‰ˆæœ¬
develop                 # é–‹ç™¼ç‰ˆæœ¬

# åŠŸèƒ½åˆ†æ”¯
feature/risk-management # æ–°åŠŸèƒ½é–‹ç™¼
feature/ui-redesign     # UI é‡æ–°è¨­è¨ˆ

# ä¿®å¾©åˆ†æ”¯
hotfix/critical-bug     # ç·Šæ€¥ä¿®å¾©
bugfix/data-validation  # ä¸€èˆ¬éŒ¯èª¤ä¿®å¾©
```

## ğŸ“š æ–‡æª”ç·¨å¯«

### 1. README æ–‡ä»¶

æ¯å€‹æ¨¡çµ„éƒ½æ‡‰åŒ…å« README.mdï¼š

```markdown
# æ¨¡çµ„åç¨±

## åŠŸèƒ½æ¦‚è¿°
ç°¡è¦æè¿°æ¨¡çµ„åŠŸèƒ½

## å®‰è£å’Œä½¿ç”¨
å®‰è£æ­¥é©Ÿå’ŒåŸºæœ¬ä½¿ç”¨æ–¹æ³•

## API åƒè€ƒ
ä¸»è¦é¡åˆ¥å’Œå‡½æ•¸çš„èªªæ˜

## ç¯„ä¾‹
å¯¦éš›ä½¿ç”¨ç¯„ä¾‹

## æ¸¬è©¦
å¦‚ä½•é‹è¡Œæ¸¬è©¦

## è²¢ç»
å¦‚ä½•è²¢ç»ä»£ç¢¼
```

### 2. API æ–‡æª”

ä½¿ç”¨ Google Style Docstringï¼š

```python
def complex_function(
    param1: str,
    param2: Optional[int] = None,
    **kwargs
) -> Dict[str, Any]:
    """è¤‡é›œå‡½æ•¸çš„æ–‡æª”ç¯„ä¾‹
    
    é€™å€‹å‡½æ•¸å±•ç¤ºäº†å¦‚ä½•ç·¨å¯«å®Œæ•´çš„æ–‡æª”å­—ç¬¦ä¸²ã€‚
    
    Args:
        param1: ç¬¬ä¸€å€‹åƒæ•¸çš„æè¿°
        param2: å¯é¸çš„ç¬¬äºŒå€‹åƒæ•¸
        **kwargs: å…¶ä»–é—œéµå­—åƒæ•¸
            - timeout (int): è¶…æ™‚æ™‚é–“
            - retries (int): é‡è©¦æ¬¡æ•¸
    
    Returns:
        åŒ…å«è™•ç†çµæœçš„å­—å…¸ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
        {
            'status': 'success' | 'error',
            'data': è™•ç†å¾Œçš„æ•¸æ“š,
            'message': ç‹€æ…‹è¨Šæ¯
        }
    
    Raises:
        ValueError: ç•¶ param1 ç‚ºç©ºæ™‚
        TimeoutError: ç•¶è™•ç†è¶…æ™‚æ™‚
    
    Example:
        >>> result = complex_function("test", timeout=30)
        >>> print(result['status'])
        'success'
    
    Note:
        æ­¤å‡½æ•¸åœ¨è™•ç†å¤§é‡æ•¸æ“šæ™‚å¯èƒ½æ¶ˆè€—è¼ƒå¤šè¨˜æ†¶é«”ã€‚
    """
    pass
```

---

**ç¶­è­·åœ˜éšŠ**: AI Trading System Development Team  
**æœ€å¾Œæ›´æ–°**: 2025-07-17
