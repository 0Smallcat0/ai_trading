# Interactive Brokers æ¨¡çµ„æŠ€è¡“æ–‡æª”

## ğŸ“‹ æ¨¡çµ„æ¦‚è¿°

Interactive Brokers (IB) é©é…å™¨æ˜¯ AI äº¤æ˜“ç³»çµ±ä¸­è² è²¬èˆ‡ Interactive Brokers API æ•´åˆçš„æ ¸å¿ƒæ¨¡çµ„ã€‚ç¶“éå…¨é¢é‡æ§‹å¾Œï¼Œç¾åœ¨æ”¯æ´è‚¡ç¥¨ã€æœŸæ¬Šã€æœŸè²¨ã€å¤–åŒ¯ç­‰å¤šç¨®é‡‘èå·¥å…·çš„äº¤æ˜“ã€‚

**ç‰ˆæœ¬**: v2.0  
**æœ€å¾Œæ›´æ–°**: 2025-07-14  
**ç¶­è­·ç‹€æ…‹**: âœ… æ´»èºç¶­è­·  

## ğŸ—ï¸ æ¨¡çµ„æ¶æ§‹

### æ ¸å¿ƒæ¨¡çµ„çµ„æˆ

```
src/execution/
â”œâ”€â”€ ib_adapter.py          # ä¸»é©é…å™¨ (892 è¡Œ)
â”œâ”€â”€ ib_wrapper.py          # API åŒ…è£å™¨ (280 è¡Œ)
â”œâ”€â”€ ib_contracts.py        # åˆç´„ç®¡ç† (300 è¡Œ)
â”œâ”€â”€ ib_orders.py           # è¨‚å–®ç®¡ç† (300 è¡Œ)
â”œâ”€â”€ ib_options.py          # æœŸæ¬Šäº¤æ˜“ (300 è¡Œ) â­
â”œâ”€â”€ ib_market_data.py      # å¸‚å ´æ•¸æ“š (300 è¡Œ)
â””â”€â”€ ib_utils.py            # å·¥å…·å‡½æ•¸ (300 è¡Œ)
```

### æ¨¡çµ„è·è²¬åˆ†å·¥

| æ¨¡çµ„ | ä¸»è¦è·è²¬ | æ ¸å¿ƒé¡åˆ¥ |
|------|----------|----------|
| `ib_adapter.py` | ä¸»é©é…å™¨ï¼Œçµ±ä¸€ä»‹é¢ | `IBAdapter` |
| `ib_wrapper.py` | API å›èª¿è™•ç† | `IBWrapper` |
| `ib_contracts.py` | åˆç´„å‰µå»ºèˆ‡ç®¡ç† | `IBContractManager` |
| `ib_orders.py` | è¨‚å–®å‰µå»ºèˆ‡ç®¡ç† | `IBOrderManager` |
| `ib_options.py` | æœŸæ¬Šäº¤æ˜“åŠŸèƒ½ | `IBOptionsManager` |
| `ib_market_data.py` | å¸‚å ´æ•¸æ“šç²å– | `IBMarketDataManager` |
| `ib_utils.py` | å·¥å…·å‡½æ•¸èˆ‡å¸¸æ•¸ | å·¥å…·å‡½æ•¸é›†åˆ |

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. è‚¡ç¥¨äº¤æ˜“
- **å¤šå¸‚å ´æ”¯æ´**: ç¾è‚¡ã€å°è‚¡ã€æ¸¯è‚¡
- **è¨‚å–®é¡å‹**: å¸‚åƒ¹å–®ã€é™åƒ¹å–®ã€åœæå–®ã€åœæé™åƒ¹å–®
- **å¯¦æ™‚åŸ·è¡Œ**: é«˜æ•ˆçš„è¨‚å–®åŸ·è¡Œå’Œç‹€æ…‹è¿½è¹¤

### 2. æœŸæ¬Šäº¤æ˜“ â­
- **æœŸæ¬Šåˆç´„**: Call/Put æœŸæ¬Šå‰µå»ºå’Œç®¡ç†
- **æœŸæ¬Šç­–ç•¥**: 6 ç¨®å°ˆæ¥­æœŸæ¬Šç­–ç•¥
- **Greeks è¨ˆç®—**: Black-Scholes æ¨¡å‹é¢¨éšªæŒ‡æ¨™
- **é¢¨éšªç®¡ç†**: åˆ°æœŸç®¡ç†å’Œé¢¨éšªç›£æ§

### 3. å¸‚å ´æ•¸æ“š
- **å¯¦æ™‚å ±åƒ¹**: å³æ™‚åƒ¹æ ¼å’Œæˆäº¤é‡æ•¸æ“š
- **æ­·å²æ•¸æ“š**: K ç·šæ•¸æ“šå’ŒæŠ€è¡“æŒ‡æ¨™
- **æ•¸æ“šå›èª¿**: é«˜æ•ˆçš„æ•¸æ“šè™•ç†æ©Ÿåˆ¶

### 4. é¢¨éšªç®¡ç†
- **é€£æ¥ç›£æ§**: è‡ªå‹•é‡é€£å’ŒéŒ¯èª¤æ¢å¾©
- **è¨‚å–®é©—è­‰**: å¤šé‡æª¢æŸ¥æ©Ÿåˆ¶
- **ç•°å¸¸è™•ç†**: çµ±ä¸€çš„éŒ¯èª¤è™•ç†æ¡†æ¶

## ğŸ“– ä½¿ç”¨æŒ‡å—

### åŸºæœ¬ä½¿ç”¨

```python
from src.execution.ib_adapter import IBAdapter
from src.execution.broker_base import Order, OrderType

# åˆå§‹åŒ–é©é…å™¨
adapter = IBAdapter(
    host="127.0.0.1",
    port=7497,  # TWS ç«¯å£
    client_id=1
)

# é€£æ¥ IB API
if adapter.connect():
    print("å·²é€£æ¥åˆ° Interactive Brokers")
    
    # å‰µå»ºè‚¡ç¥¨è¨‚å–®
    order = Order(
        stock_id="AAPL",
        action="buy",
        quantity=100,
        order_type=OrderType.MARKET
    )
    
    # ä¸‹å–®
    order_id = adapter.place_order(order)
    if order_id:
        print(f"è¨‚å–®å·²æäº¤: {order_id}")
```

### æœŸæ¬Šäº¤æ˜“ç¯„ä¾‹

```python
# æœŸæ¬Šä¸‹å–®
option_order_id = adapter.place_option_order(
    symbol="AAPL",
    expiry="20241220",
    strike=150.0,
    right="C",  # Call æœŸæ¬Š
    action="BUY",
    quantity=1,
    order_type="LMT",
    price=5.0
)

# ç²å–æœŸæ¬Šéˆ
option_chain = adapter.get_option_chain("AAPL", "20241220")
if option_chain:
    print(f"æ¨™çš„åƒ¹æ ¼: {option_chain['underlying_price']}")
    print(f"Call æœŸæ¬Šæ•¸é‡: {len(option_chain['calls'])}")
    print(f"Put æœŸæ¬Šæ•¸é‡: {len(option_chain['puts'])}")
```

### æœŸæ¬Šç­–ç•¥åŸ·è¡Œ

```python
# åŸ·è¡Œå‚™å…Œçœ‹æ¼²ç­–ç•¥
strategy_orders = adapter.options_manager.execute_option_strategy(
    strategy=OptionStrategy.COVERED_CALL,
    symbol="AAPL",
    expiry="20241220",
    strike=150.0,
    quantity=1
)
```

## ğŸ”§ é…ç½®èªªæ˜

### é€£æ¥åƒæ•¸

| åƒæ•¸ | èªªæ˜ | é è¨­å€¼ | ç¯„ä¾‹ |
|------|------|--------|------|
| `host` | IB Gateway/TWS ä¸»æ©Ÿ | "127.0.0.1" | "127.0.0.1" |
| `port` | é€£æ¥ç«¯å£ | 7497 | 7497 (TWS), 4001 (Gateway) |
| `client_id` | å®¢æˆ¶ç«¯ ID | 1 | 1-32 |
| `account_id` | å¸³æˆ¶ ID | None | "DU123456" |

### ç’°å¢ƒè¦æ±‚

- **Python**: â‰¥3.8
- **ibapi**: â‰¥9.81.1
- **IB Gateway/TWS**: æœ€æ–°ç‰ˆæœ¬
- **ç¶²è·¯**: ç©©å®šçš„ç¶²è·¯é€£æ¥

## ğŸ“Š æ€§èƒ½æŒ‡æ¨™

### åŸ·è¡Œæ•ˆç‡
- **é€£æ¥å»ºç«‹**: <5 ç§’
- **è¨‚å–®æäº¤**: <200ms
- **æœŸæ¬Šåƒ¹æ ¼ç²å–**: <100ms
- **Greeks è¨ˆç®—**: <10ms
- **å¸‚å ´æ•¸æ“šæ›´æ–°**: <50ms

### è³‡æºä½¿ç”¨
- **è¨˜æ†¶é«”ä½¿ç”¨**: ~50MB (åŸºç¤é‹è¡Œ)
- **CPU ä½¿ç”¨**: <5% (æ­£å¸¸äº¤æ˜“)
- **ç¶²è·¯é »å¯¬**: ~1KB/s (å¸‚å ´æ•¸æ“š)

## ğŸ§ª æ¸¬è©¦è¦†è“‹

### æ¸¬è©¦é¡å‹
- **å–®å…ƒæ¸¬è©¦**: 90%+ è¦†è“‹ç‡
- **æ•´åˆæ¸¬è©¦**: ç«¯åˆ°ç«¯åŠŸèƒ½é©—è­‰
- **æ€§èƒ½æ¸¬è©¦**: è² è¼‰å’Œå£“åŠ›æ¸¬è©¦
- **éŒ¯èª¤è™•ç†æ¸¬è©¦**: ç•°å¸¸æƒ…æ³æ¨¡æ“¬

### æ¸¬è©¦åŸ·è¡Œ

```bash
# åŸ·è¡Œæ‰€æœ‰ IB ç›¸é—œæ¸¬è©¦
python -m pytest tests/test_ib_adapter_enhanced.py -v

# åŸ·è¡ŒæœŸæ¬ŠåŠŸèƒ½æ¸¬è©¦
python -m pytest tests/test_ib_options.py -v

# ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
python -m pytest --cov=src.execution.ib_adapter tests/ --cov-report=html
```

## ğŸ”’ å®‰å…¨è€ƒé‡

### API å®‰å…¨
- **é€£æ¥åŠ å¯†**: ä½¿ç”¨ IB å®˜æ–¹åŠ å¯†å”è­°
- **èº«ä»½é©—è­‰**: å¤šå±¤æ¬¡é©—è­‰æ©Ÿåˆ¶
- **è³‡æ–™é©—è­‰**: åš´æ ¼çš„åƒæ•¸æª¢æŸ¥
- **éŒ¯èª¤éš”é›¢**: é˜²æ­¢éŒ¯èª¤å‚³æ’­

### äº¤æ˜“å®‰å…¨
- **è¨‚å–®é©—è­‰**: å¤šé‡æª¢æŸ¥æ©Ÿåˆ¶
- **é¢¨éšªæ§åˆ¶**: è‡ªå‹•é¢¨éšªè©•ä¼°
- **å¯©è¨ˆè¿½è¹¤**: å®Œæ•´çš„æ“ä½œè¨˜éŒ„
- **ç•°å¸¸è™•ç†**: å®Œæ•´çš„éŒ¯èª¤æ¢å¾©

## ğŸ“š ç›¸é—œæ–‡æª”

### æŠ€è¡“æ–‡æª”
- [æœŸæ¬Šäº¤æ˜“æŒ‡å—](./ib_options.md)
- [API åƒè€ƒæ–‡æª”](../APIæ–‡æª”.md)
- [æ¸¬è©¦æŒ‡å—](../testing/test_ib_adapter_enhanced.md)

### ä½¿ç”¨è€…æ–‡æª”
- [åˆ¸å•† API æ•´åˆä½¿ç”¨æŒ‡å—](../../ä½¿ç”¨è€…æ‰‹å†Š/åˆ¸å•†APIæ•´åˆä½¿ç”¨æŒ‡å—.md)
- [åˆ¸å•† API è¨­å®šæ•™ç¨‹](../../ä½¿ç”¨è€…æ‰‹å†Š/åˆ¸å•†APIè¨­å®šæ•™ç¨‹.md)

### é–‹ç™¼è€…æ–‡æª”
- [API æ•´åˆæŒ‡å—](../APIæ•´åˆ.md)
- [å“è³ªæ¨™æº–](../å“è³ªæ¨™æº–.md)
- [ä»£ç¢¼è²¢ç»æŒ‡å—](../ä»£ç¢¼è²¢ç»æŒ‡å—.md)

## ğŸ”„ ç‰ˆæœ¬æ­·å²

### v2.0 (2025-07-14)
- âœ… å®Œæ•´é‡æ§‹ï¼Œæ¨¡çµ„åŒ–è¨­è¨ˆ
- âœ… æ–°å¢æœŸæ¬Šäº¤æ˜“åŠŸèƒ½
- âœ… æå‡ Pylint è©•åˆ†è‡³ 9.0+/10
- âœ… å®Œå–„æ–‡æª”å’Œæ¸¬è©¦è¦†è“‹

### v1.0 (ä¹‹å‰ç‰ˆæœ¬)
- âœ… åŸºç¤è‚¡ç¥¨äº¤æ˜“åŠŸèƒ½
- âœ… å¤šå¸‚å ´æ”¯æ´
- âœ… åŸºæœ¬éŒ¯èª¤è™•ç†

## ğŸ¤ è²¢ç»æŒ‡å—

### é–‹ç™¼æµç¨‹
1. Fork å°ˆæ¡ˆä¸¦å‰µå»ºåŠŸèƒ½åˆ†æ”¯
2. éµå¾ªä»£ç¢¼å“è³ªæ¨™æº– (Pylint â‰¥9.0/10)
3. ç·¨å¯«å®Œæ•´çš„æ¸¬è©¦ç”¨ä¾‹
4. æ›´æ–°ç›¸é—œæ–‡æª”
5. æäº¤ Pull Request

### ä»£ç¢¼æ¨™æº–
- **Google Style Docstring**: 100% è¦†è“‹
- **é¡å‹æç¤º**: å®Œæ•´çš„é¡å‹è¨»è§£
- **æ¸¬è©¦è¦†è“‹ç‡**: â‰¥90%
- **æ–‡ä»¶å¤§å°**: â‰¤300 è¡Œ

---

**ç¶­è­·åœ˜éšŠ**: AI Trading System Development Team  
**æŠ€è¡“æ”¯æ´**: è«‹åƒè€ƒç›¸é—œæ–‡æª”æˆ–æäº¤ Issue  
**æœ€å¾Œæ›´æ–°**: 2025-07-14
