# å“è³ªæª¢æŸ¥å·¥å…·ä½¿ç”¨æ‰‹å†Š

**ç‰ˆæœ¬**: v2.0  
**æ›´æ–°æ—¥æœŸ**: 2025-01-13  
**é©ç”¨ç¯„åœ**: AI è‚¡ç¥¨è‡ªå‹•äº¤æ˜“ç³»çµ±

## ğŸ“‹ æ¦‚è¿°

æœ¬æ‰‹å†Šè©³ç´°ä»‹ç´¹äº† AI è‚¡ç¥¨è‡ªå‹•äº¤æ˜“ç³»çµ±ä¸­ä½¿ç”¨çš„å„ç¨®å“è³ªæª¢æŸ¥å·¥å…·ï¼ŒåŒ…æ‹¬å®‰è£ã€é…ç½®ã€ä½¿ç”¨æ–¹æ³•å’Œæ•…éšœæ’é™¤ã€‚

## ğŸ› ï¸ å·¥å…·æ¦‚è¦½

### æ ¸å¿ƒå“è³ªæª¢æŸ¥å·¥å…·
| å·¥å…· | åŠŸèƒ½ | ç‰ˆæœ¬è¦æ±‚ | é…ç½®æª”æ¡ˆ |
|------|------|----------|----------|
| Pylint | éœæ…‹ç¨‹å¼ç¢¼åˆ†æ | â‰¥3.0.0 | pyproject.toml |
| Black | ç¨‹å¼ç¢¼æ ¼å¼åŒ– | â‰¥24.0.0 | pyproject.toml |
| isort | å°å…¥æ’åº | â‰¥5.13.0 | pyproject.toml |
| MyPy | å‹åˆ¥æª¢æŸ¥ | â‰¥1.8.0 | pyproject.toml |
| Bandit | å®‰å…¨æƒæ | â‰¥1.7.5 | pyproject.toml |
| pytest | æ¸¬è©¦åŸ·è¡Œ | â‰¥8.0.0 | pyproject.toml |
| Radon | è¤‡é›œåº¦åˆ†æ | â‰¥6.0.1 | - |

### å¢å¼·åˆ†æå·¥å…·
| å·¥å…· | åŠŸèƒ½ | ç”¨é€” |
|------|------|------|
| Safety | ä¾è³´æ¼æ´æª¢æŸ¥ | å®‰å…¨æ€§åˆ†æ |
| pre-commit | æäº¤å‰æª¢æŸ¥ | è‡ªå‹•åŒ–å“è³ªæ§åˆ¶ |
| Coverage | æ¸¬è©¦è¦†è“‹ç‡ | æ¸¬è©¦å“è³ªè©•ä¼° |

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. å·¥å…·å®‰è£

#### 1.1 ä½¿ç”¨ Poetry å®‰è£ï¼ˆæ¨è–¦ï¼‰
```bash
# å®‰è£æ‰€æœ‰é–‹ç™¼ä¾è³´
poetry install --with dev,test

# é©—è­‰å®‰è£
poetry run pylint --version
poetry run black --version
poetry run pytest --version
```

#### 1.2 ä½¿ç”¨ pip å®‰è£
```bash
# å®‰è£å“è³ªæª¢æŸ¥å·¥å…·
pip install pylint black isort mypy bandit pytest pytest-cov radon safety

# å®‰è£ pre-commit
pip install pre-commit
pre-commit install
```

### 2. ä¸€éµå“è³ªæª¢æŸ¥

#### 2.1 åŸ·è¡Œå®Œæ•´æª¢æŸ¥
```bash
# åŸ·è¡Œæ‰€æœ‰å“è³ªæª¢æŸ¥
python scripts/run_quality_checks.py

# è‡ªå‹•ä¿®å¾©å¯ä¿®å¾©çš„å•é¡Œ
python scripts/run_quality_checks.py --fix

# å®‰è£ç¼ºå°‘çš„å·¥å…·
python scripts/run_quality_checks.py --install-tools
```

#### 2.2 æª¢æŸ¥çµæœè§£è®€
```
ğŸš€ é–‹å§‹åŸ·è¡Œç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥...
ğŸ“‹ æª”æ¡ˆå¤§å°æª¢æŸ¥...
âœ… æ‰€æœ‰æª”æ¡ˆéƒ½ç¬¦åˆ â‰¤300 è¡Œæ¨™æº–
ğŸ¨ ç¨‹å¼ç¢¼æ ¼å¼åŒ–æª¢æŸ¥...
âœ… ç¨‹å¼ç¢¼æ ¼å¼ç¬¦åˆ Black æ¨™æº–
ğŸ“¦ å°å…¥æ’åºæª¢æŸ¥...
âœ… å°å…¥æ’åºç¬¦åˆæ¨™æº–
ğŸ” ç¨‹å¼ç¢¼é¢¨æ ¼æª¢æŸ¥...
âœ… Flake8 é¢¨æ ¼æª¢æŸ¥é€šé
ğŸ”¬ éœæ…‹åˆ†æ...
âœ… Pylint è©•åˆ†: 9.2/10
ğŸ·ï¸ å‹åˆ¥æª¢æŸ¥...
âœ… MyPy å‹åˆ¥æª¢æŸ¥é€šé
ğŸ”’ å®‰å…¨æƒæ...
âœ… æœªç™¼ç¾å®‰å…¨å•é¡Œ
ğŸ›¡ï¸ ä¾è³´æ¼æ´æª¢æŸ¥...
âœ… ä¾è³´å®‰å…¨æª¢æŸ¥é€šé
ğŸ§ª æ¸¬è©¦è¦†è“‹ç‡...
âœ… æ¸¬è©¦è¦†è“‹ç‡: 92%

ğŸ‰ æ‰€æœ‰å“è³ªæª¢æŸ¥éƒ½é€šéï¼
```

## ğŸ”§ å€‹åˆ¥å·¥å…·ä½¿ç”¨

### 1. Pylint - éœæ…‹ç¨‹å¼ç¢¼åˆ†æ

#### 1.1 åŸºæœ¬ä½¿ç”¨
```bash
# æª¢æŸ¥å–®å€‹æª”æ¡ˆ
pylint src/risk_management/risk_manager.py

# æª¢æŸ¥æ•´å€‹æ¨¡çµ„
pylint src/risk_management/

# æª¢æŸ¥ä¸¦è¨­å®šæœ€ä½è©•åˆ†
pylint src/risk_management/ --fail-under=9.0

# ç”Ÿæˆè©³ç´°å ±å‘Š
pylint src/ --output-format=text --reports=yes > pylint_report.txt
```

#### 1.2 é…ç½®èªªæ˜
```toml
# pyproject.toml ä¸­çš„ Pylint é…ç½®
[tool.pylint.messages_control]
disable = [
    "C0114",  # missing-module-docstring
    "C0115",  # missing-class-docstring  
    "C0116",  # missing-function-docstring
    "R0903",  # too-few-public-methods
]

[tool.pylint.format]
max-line-length = 88

[tool.pylint.design]
max-args = 5
max-locals = 15
max-statements = 50
```

#### 1.3 å¸¸è¦‹å•é¡Œè§£æ±º
```python
# C0103: Invalid name (è§£æ±ºæ–¹æ¡ˆï¼šä½¿ç”¨æè¿°æ€§åç¨±)
# éŒ¯èª¤
x = 10
# æ­£ç¢º
max_position_size = 10

# R0913: Too many arguments (è§£æ±ºæ–¹æ¡ˆï¼šä½¿ç”¨å­—å…¸æˆ–é¡åˆ¥)
# éŒ¯èª¤
def trade(symbol, quantity, price, stop_loss, take_profit, order_type):
    pass

# æ­£ç¢º
def trade(order_params: dict):
    pass

# W0613: Unused argument (è§£æ±ºæ–¹æ¡ˆï¼šä½¿ç”¨åº•ç·šå‰ç¶´)
# éŒ¯èª¤
def callback(data, unused_param):
    return data

# æ­£ç¢º
def callback(data, _unused_param):
    return data
```

### 2. Black - ç¨‹å¼ç¢¼æ ¼å¼åŒ–

#### 2.1 åŸºæœ¬ä½¿ç”¨
```bash
# æª¢æŸ¥æ ¼å¼ï¼ˆä¸ä¿®æ”¹ï¼‰
black --check src/

# æ ¼å¼åŒ–ç¨‹å¼ç¢¼
black src/

# é¡¯ç¤ºå·®ç•°
black --diff src/

# æ ¼å¼åŒ–ç‰¹å®šæª”æ¡ˆ
black src/risk_management/risk_manager.py
```

#### 2.2 é…ç½®é¸é …
```toml
[tool.black]
line-length = 88
target-version = ['py310', 'py311']
include = '\.pyi?$'
extend-exclude = '''
/(
  \.eggs
  | \.git
  | \.venv
  | build
  | dist
)/
'''
```

### 3. isort - å°å…¥æ’åº

#### 3.1 åŸºæœ¬ä½¿ç”¨
```bash
# æª¢æŸ¥å°å…¥æ’åº
isort --check-only src/

# æ’åºå°å…¥
isort src/

# é¡¯ç¤ºå·®ç•°
isort --diff src/

# èˆ‡ Black å…¼å®¹
isort --profile=black src/
```

#### 3.2 å°å…¥é †åºè¦å‰‡
```python
# æ­£ç¢ºçš„å°å…¥é †åº
# 1. æ¨™æº–åº«
import os
import sys
from datetime import datetime

# 2. ç¬¬ä¸‰æ–¹åº«
import pandas as pd
import numpy as np
from fastapi import FastAPI

# 3. æœ¬åœ°å°å…¥
from src.core.config import settings
from src.risk_management.risk_manager import RiskManager
```

### 4. MyPy - å‹åˆ¥æª¢æŸ¥

#### 4.1 åŸºæœ¬ä½¿ç”¨
```bash
# æª¢æŸ¥å‹åˆ¥
mypy src/

# æª¢æŸ¥ç‰¹å®šæª”æ¡ˆ
mypy src/risk_management/risk_manager.py

# å¿½ç•¥ç¼ºå°‘çš„å°å…¥
mypy --ignore-missing-imports src/

# é¡¯ç¤ºéŒ¯èª¤ä»£ç¢¼
mypy --show-error-codes src/
```

#### 4.2 å‹åˆ¥è¨»è§£ç¯„ä¾‹
```python
from typing import List, Dict, Optional, Union

def calculate_risk(
    positions: List[Dict[str, Union[str, float]]],
    portfolio_value: float,
    risk_tolerance: Optional[float] = None
) -> Dict[str, float]:
    """è¨ˆç®—æŠ•è³‡çµ„åˆé¢¨éšªæŒ‡æ¨™.
    
    Args:
        positions: æŒå€‰åˆ—è¡¨
        portfolio_value: æŠ•è³‡çµ„åˆç¸½å€¼
        risk_tolerance: é¢¨éšªå®¹å¿åº¦ï¼ˆå¯é¸ï¼‰
        
    Returns:
        Dict[str, float]: é¢¨éšªæŒ‡æ¨™å­—å…¸
    """
    if risk_tolerance is None:
        risk_tolerance = 0.02
    
    total_risk = sum(pos['value'] * pos['risk'] for pos in positions)
    risk_ratio = total_risk / portfolio_value
    
    return {
        'total_risk': total_risk,
        'risk_ratio': risk_ratio,
        'risk_tolerance': risk_tolerance
    }
```

### 5. Bandit - å®‰å…¨æƒæ

#### 5.1 åŸºæœ¬ä½¿ç”¨
```bash
# æƒæå®‰å…¨å•é¡Œ
bandit -r src/

# ç”Ÿæˆ JSON å ±å‘Š
bandit -r src/ -f json -o security_report.json

# æ’é™¤ç‰¹å®šæ¸¬è©¦
bandit -r src/ -s B101,B601

# åªæƒæé«˜åš´é‡æ€§å•é¡Œ
bandit -r src/ -ll
```

#### 5.2 å¸¸è¦‹å®‰å…¨å•é¡Œ
```python
# B105: ç¡¬ç·¨ç¢¼å¯†ç¢¼ï¼ˆéŒ¯èª¤ï¼‰
password = "hardcoded_password"

# æ­£ç¢ºåšæ³•
import os
password = os.getenv('PASSWORD')

# B108: è‡¨æ™‚æª”æ¡ˆä¸å®‰å…¨ï¼ˆéŒ¯èª¤ï¼‰
temp_file = "/tmp/temp_file"

# æ­£ç¢ºåšæ³•
import tempfile
with tempfile.NamedTemporaryFile() as temp_file:
    pass

# B301: pickle ä¸å®‰å…¨ï¼ˆéŒ¯èª¤ï¼‰
import pickle
data = pickle.loads(user_input)

# æ­£ç¢ºåšæ³•
import json
data = json.loads(user_input)
```

### 6. pytest - æ¸¬è©¦åŸ·è¡Œ

#### 6.1 åŸºæœ¬ä½¿ç”¨
```bash
# åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
pytest

# åŸ·è¡Œç‰¹å®šæ¸¬è©¦æª”æ¡ˆ
pytest tests/test_risk_manager.py

# åŸ·è¡Œç‰¹å®šæ¸¬è©¦å‡½æ•¸
pytest tests/test_risk_manager.py::test_calculate_position_size

# é¡¯ç¤ºè¦†è“‹ç‡
pytest --cov=src --cov-report=term-missing

# ç”Ÿæˆ HTML è¦†è“‹ç‡å ±å‘Š
pytest --cov=src --cov-report=html
```

#### 6.2 æ¸¬è©¦çµ„ç¹”
```python
# tests/test_risk_manager.py
import pytest
from src.risk_management.risk_manager import RiskManager

class TestRiskManager:
    """é¢¨éšªç®¡ç†å™¨æ¸¬è©¦."""
    
    @pytest.fixture
    def risk_manager(self):
        """æ¸¬è©¦ç”¨é¢¨éšªç®¡ç†å™¨."""
        return RiskManager()
    
    def test_calculate_position_size(self, risk_manager):
        """æ¸¬è©¦å€‰ä½è¨ˆç®—."""
        result = risk_manager.calculate_position_size(
            balance=100000,
            risk_pct=0.02,
            stop_distance=5.0
        )
        assert result == 400.0
    
    @pytest.mark.parametrize("balance,risk_pct,expected", [
        (100000, 0.01, 200.0),
        (200000, 0.02, 800.0),
        (50000, 0.03, 300.0),
    ])
    def test_position_size_parameters(self, risk_manager, balance, risk_pct, expected):
        """åƒæ•¸åŒ–æ¸¬è©¦."""
        result = risk_manager.calculate_position_size(balance, risk_pct, 5.0)
        assert result == expected
```

## ğŸ“Š å“è³ªå ±å‘Š

### 1. è‡ªå‹•åŒ–å ±å‘Šç”Ÿæˆ

#### 1.1 ç”Ÿæˆå“è³ªå ±å‘Š
```bash
# ç”Ÿæˆå®Œæ•´å“è³ªå ±å‘Š
python scripts/generate_quality_report.py

# æŸ¥çœ‹æœ€æ–°å ±å‘Š
open docs/reports/quality-report-latest.html
```

#### 1.2 å ±å‘Šå…§å®¹
- **ç¸½è¦½**: é—œéµå“è³ªæŒ‡æ¨™
- **è¤‡é›œåº¦åˆ†æ**: ç¨‹å¼ç¢¼è¤‡é›œåº¦çµ±è¨ˆ
- **ä¾è³´é—œä¿‚**: æ¨¡çµ„ä¾è³´åˆ†æ
- **è¶¨å‹¢åˆ†æ**: æ­·å²å“è³ªè¶¨å‹¢
- **æ”¹é€²å»ºè­°**: å¯æ“ä½œçš„æ”¹é€²å»ºè­°

### 2. é€šçŸ¥ç³»çµ±

#### 2.1 è¨­å®šé€šçŸ¥
```bash
# è¨­å®šç’°å¢ƒè®Šæ•¸
export SLACK_WEBHOOK_URL="https://hooks.slack.com/services/..."
export TEAMS_WEBHOOK_URL="https://outlook.office.com/webhook/..."

# æ¸¬è©¦é€šçŸ¥
python scripts/run_notifications.py --test

# æª¢æŸ¥å“è³ªè­¦å ±
python scripts/run_notifications.py --check-alerts
```

## ğŸ”§ æ•…éšœæ’é™¤

### 1. å¸¸è¦‹å•é¡Œ

#### 1.1 å·¥å…·å®‰è£å•é¡Œ
```bash
# å•é¡Œï¼šModuleNotFoundError
# è§£æ±ºï¼šç¢ºä¿åœ¨æ­£ç¢ºçš„è™›æ“¬ç’°å¢ƒä¸­
poetry shell
poetry install --with dev,test

# å•é¡Œï¼šæ¬Šé™éŒ¯èª¤
# è§£æ±ºï¼šä½¿ç”¨ --user å®‰è£
pip install --user pylint black isort
```

#### 1.2 é…ç½®å•é¡Œ
```bash
# å•é¡Œï¼šPylint æ‰¾ä¸åˆ°æ¨¡çµ„
# è§£æ±ºï¼šè¨­å®š PYTHONPATH
export PYTHONPATH="${PYTHONPATH}:$(pwd)"

# å•é¡Œï¼špre-commit é‰¤å­å¤±æ•—
# è§£æ±ºï¼šé‡æ–°å®‰è£é‰¤å­
pre-commit uninstall
pre-commit install
```

### 2. æ€§èƒ½å„ªåŒ–

#### 2.1 åŠ é€Ÿæª¢æŸ¥
```bash
# ä½¿ç”¨ä¸¦è¡Œè™•ç†
pylint -j 4 src/

# åªæª¢æŸ¥ä¿®æ”¹çš„æª”æ¡ˆ
git diff --name-only | grep '\.py$' | xargs pylint

# ä½¿ç”¨å¿«å–
export PYLINT_CACHE_DIR=.pylint_cache
```

## ğŸ“š é€²éšä½¿ç”¨

### 1. è‡ªå®šç¾©è¦å‰‡

#### 1.1 Pylint è‡ªå®šç¾©æª¢æŸ¥
```python
# custom_checkers.py
from pylint.checkers import BaseChecker
from pylint.interfaces import IAstroidChecker

class TradingSpecificChecker(BaseChecker):
    """äº¤æ˜“ç³»çµ±ç‰¹å®šæª¢æŸ¥å™¨."""
    
    __implements__ = IAstroidChecker
    name = 'trading-specific'
    msgs = {
        'W9001': (
            'Trading function should have risk validation',
            'missing-risk-validation',
            'All trading functions should validate risk parameters'
        ),
    }
    
    def visit_functiondef(self, node):
        if 'trade' in node.name.lower():
            # æª¢æŸ¥æ˜¯å¦æœ‰é¢¨éšªé©—è­‰
            pass
```

### 2. CI/CD æ•´åˆ

#### 2.1 GitHub Actions é…ç½®
```yaml
# .github/workflows/quality-check.yml
name: Quality Check
on: [push, pull_request]

jobs:
  quality:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    - name: Install dependencies
      run: |
        pip install poetry
        poetry install --with dev,test
    - name: Run quality checks
      run: poetry run python scripts/run_quality_checks.py
```

## ğŸ”— ç›¸é—œè³‡æº

### æ–‡æª”é€£çµ
- [é–‹ç™¼è€…å“è³ªæ¨™æº–æŒ‡å—](../é–‹ç™¼è€…æŒ‡å—/å“è³ªæ¨™æº–.md)
- [æ¸¬è©¦æ¡†æ¶æŒ‡å—](./æ¸¬è©¦æ¡†æ¶.md)
- [CI/CD é…ç½®æŒ‡å—](./CICDé…ç½®.md)

### å·¥å…·å®˜æ–¹æ–‡æª”
- [Pylint æ–‡æª”](https://pylint.pycqa.org/)
- [Black æ–‡æª”](https://black.readthedocs.io/)
- [isort æ–‡æª”](https://pycqa.github.io/isort/)
- [MyPy æ–‡æª”](https://mypy.readthedocs.io/)
- [Bandit æ–‡æª”](https://bandit.readthedocs.io/)
- [pytest æ–‡æª”](https://docs.pytest.org/)
