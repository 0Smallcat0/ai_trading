# -*- coding: utf-8 -*-
"""
æ•´åˆä¸»ç•Œé¢ - å¤šä»£ç†AIäº¤æ˜“ç³»çµ±

æ­¤æ¨¡çµ„æä¾›çµ±ä¸€çš„ä¸»ç•Œé¢ï¼Œæ•´åˆäº†ï¼š
- Phase 1-6 é–‹ç™¼çš„å¤šä»£ç†AIäº¤æ˜“ç³»çµ±
- åŸå§‹é …ç›®çš„å‚³çµ±é‡åŒ–äº¤æ˜“åŠŸèƒ½
- çµ±ä¸€çš„ç”¨æˆ¶é«”é©—å’Œå°èˆª

ä¸»è¦åŠŸèƒ½ï¼š
- å¤šä»£ç†AIç³»çµ±ç®¡ç†
- å‚³çµ±é‡åŒ–äº¤æ˜“åŠŸèƒ½
- çµ±ä¸€çš„æ•¸æ“šç®¡ç†
- ç¶œåˆçš„ç¸¾æ•ˆç›£æ§
- å®Œæ•´çš„é¢¨éšªç®¡ç†
- ç³»çµ±è¨­ç½®å’Œé…ç½®

æ•´åˆç‰¹è‰²ï¼š
- ç„¡ç¸«åŠŸèƒ½åˆ‡æ›
- çµ±ä¸€çš„ç•Œé¢é¢¨æ ¼
- ä¸€è‡´çš„ç”¨æˆ¶é«”é©—
- å®Œæ•´çš„åŠŸèƒ½è¦†è“‹
"""

import streamlit as st
import pandas as pd
import plotly.express as px
import plotly.graph_objects as go
from datetime import datetime, timedelta
import logging
import sys
import os

# æ·»åŠ é …ç›®è·¯å¾‘
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

# è¨­å®šæ—¥èªŒ
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

def main():
    """æ•´åˆä¸»ç•Œé¢å…¥å£"""
    st.set_page_config(
        page_title="å¤šä»£ç†AIé‡åŒ–äº¤æ˜“ç³»çµ±",
        page_icon="ğŸ¤–",
        layout="wide",
        initial_sidebar_state="expanded"
    )
    
    # è‡ªå®šç¾©CSSæ¨£å¼
    st.markdown("""
    <style>
    .main-header {
        background: linear-gradient(90deg, #1f77b4, #ff7f0e);
        padding: 1.5rem;
        border-radius: 10px;
        color: white;
        text-align: center;
        margin-bottom: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .feature-card {
        background: #f8f9fa;
        padding: 1rem;
        border-radius: 8px;
        border-left: 4px solid #1f77b4;
        margin-bottom: 1rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
    }
    
    .status-online { background-color: #28a745; }
    .status-offline { background-color: #6c757d; }
    .status-warning { background-color: #ffc107; }
    .status-error { background-color: #dc3545; }
    
    .metric-card {
        background: white;
        padding: 1rem;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        text-align: center;
    }
    </style>
    """, unsafe_allow_html=True)
    
    # ä¸»æ¨™é¡Œ
    st.markdown("""
    <div class="main-header">
        <h1>ğŸ¤– å¤šä»£ç†AIé‡åŒ–äº¤æ˜“ç³»çµ±</h1>
        <p>æ•´åˆå‚³çµ±é‡åŒ–äº¤æ˜“èˆ‡å¤šä»£ç†AIå”ä½œçš„æ™ºèƒ½æŠ•è³‡å¹³å°</p>
        <small>Phase 1-6 å®Œæ•´æ•´åˆç‰ˆ | ç‰ˆæœ¬ 2.0.0</small>
    </div>
    """, unsafe_allow_html=True)
    
    # å´é‚Šæ¬„å°èˆª
    with st.sidebar:
        st.title("ğŸ§­ ç³»çµ±å°èˆª")
        
        # ç³»çµ±ç‹€æ…‹
        st.markdown("### ğŸš¦ ç³»çµ±ç‹€æ…‹")
        show_system_status()
        
        st.markdown("---")
        
        # ä¸»è¦åŠŸèƒ½æ¨¡çµ„
        st.markdown("### ğŸ¤– å¤šä»£ç†AIç³»çµ±")
        ai_functions = [
            "ğŸ“Š å¤šä»£ç†å„€è¡¨æ¿",
            "ğŸ¤– ä»£ç†ç®¡ç†ä¸­å¿ƒ", 
            "ğŸ“ˆ AIç¸¾æ•ˆç›£æ§",
            "âš™ï¸ æ™ºèƒ½é…ç½®ç®¡ç†",
            "ğŸ¤ å”ä½œæ©Ÿåˆ¶æ§åˆ¶"
        ]
        
        ai_selection = st.radio("AIåŠŸèƒ½æ¨¡çµ„", ai_functions, key="ai_nav")
        
        st.markdown("---")
        st.markdown("### ğŸ“ˆ å‚³çµ±é‡åŒ–ç³»çµ±")
        traditional_functions = [
            "ğŸ“Š ç³»çµ±æ¦‚è¦½",
            "ğŸ“ˆ æ•¸æ“šæºç®¡ç†", 
            "ğŸ§  ç­–ç•¥å›æ¸¬",
            "ğŸ’¼ æŠ•è³‡çµ„åˆç®¡ç†",
            "âš ï¸ é¢¨éšªæ§åˆ¶",
            "ğŸ”§ ç³»çµ±é…ç½®"
        ]
        
        traditional_selection = st.radio("é‡åŒ–åŠŸèƒ½æ¨¡çµ„", traditional_functions, key="traditional_nav")
        
        st.markdown("---")
        
        # å¿«é€Ÿæ“ä½œ
        st.markdown("### âš¡ å¿«é€Ÿæ“ä½œ")
        show_quick_actions()
    
    # ä¸»å…§å®¹å€åŸŸ
    main_content_area(ai_selection, traditional_selection)

def show_system_status():
    """é¡¯ç¤ºç³»çµ±ç‹€æ…‹"""
    try:
        # æ¨¡æ“¬ç³»çµ±ç‹€æ…‹
        statuses = {
            "å¤šä»£ç†ç³»çµ±": "online",
            "æ•¸æ“šæ”¶é›†": "online", 
            "ç­–ç•¥å¼•æ“": "online",
            "é¢¨éšªç›£æ§": "warning",
            "äº¤æ˜“åŸ·è¡Œ": "online"
        }
        
        for system, status in statuses.items():
            if status == "online":
                st.markdown(f'<span class="status-indicator status-online"></span>{system}', unsafe_allow_html=True)
            elif status == "warning":
                st.markdown(f'<span class="status-indicator status-warning"></span>{system}', unsafe_allow_html=True)
            elif status == "error":
                st.markdown(f'<span class="status-indicator status-error"></span>{system}', unsafe_allow_html=True)
            else:
                st.markdown(f'<span class="status-indicator status-offline"></span>{system}', unsafe_allow_html=True)
                
    except Exception as e:
        st.error(f"ç‹€æ…‹ç²å–å¤±æ•—: {e}")

def show_quick_actions():
    """é¡¯ç¤ºå¿«é€Ÿæ“ä½œæŒ‰éˆ•"""
    if st.button("ğŸš€ å•Ÿå‹•AIç³»çµ±", key="start_ai"):
        st.success("âœ… AIç³»çµ±å•Ÿå‹•ä¸­...")
        
    if st.button("ğŸ“Š ç”Ÿæˆç¶œåˆå ±å‘Š", key="generate_report"):
        st.success("âœ… å ±å‘Šç”Ÿæˆä¸­...")
        
    if st.button("ğŸ”„ ç³»çµ±å¥åº·æª¢æŸ¥", key="health_check"):
        st.success("âœ… å¥åº·æª¢æŸ¥å®Œæˆ")
        
    if st.button("ğŸ’¾ å‚™ä»½é…ç½®", key="backup_config"):
        st.success("âœ… é…ç½®å·²å‚™ä»½")

def main_content_area(ai_selection, traditional_selection):
    """ä¸»å…§å®¹å€åŸŸ"""
    
    # æ ¹æ“šé¸æ“‡é¡¯ç¤ºå°æ‡‰åŠŸèƒ½
    if ai_selection == "ğŸ“Š å¤šä»£ç†å„€è¡¨æ¿":
        show_multi_agent_dashboard()
    elif ai_selection == "ğŸ¤– ä»£ç†ç®¡ç†ä¸­å¿ƒ":
        show_agent_management()
    elif ai_selection == "ğŸ“ˆ AIç¸¾æ•ˆç›£æ§":
        show_ai_performance_monitor()
    elif ai_selection == "âš™ï¸ æ™ºèƒ½é…ç½®ç®¡ç†":
        show_intelligent_config()
    elif ai_selection == "ğŸ¤ å”ä½œæ©Ÿåˆ¶æ§åˆ¶":
        show_coordination_control()
    elif traditional_selection == "ğŸ“Š ç³»çµ±æ¦‚è¦½":
        show_system_overview()
    elif traditional_selection == "ğŸ“ˆ æ•¸æ“šæºç®¡ç†":
        show_data_management()
    elif traditional_selection == "ğŸ§  ç­–ç•¥å›æ¸¬":
        show_strategy_backtest()
    elif traditional_selection == "ğŸ’¼ æŠ•è³‡çµ„åˆç®¡ç†":
        show_portfolio_management()
    elif traditional_selection == "âš ï¸ é¢¨éšªæ§åˆ¶":
        show_risk_management()
    elif traditional_selection == "ğŸ”§ ç³»çµ±é…ç½®":
        show_system_settings()

def show_multi_agent_dashboard():
    """å¤šä»£ç†å„€è¡¨æ¿"""
    st.header("ğŸ“Š å¤šä»£ç†AIå„€è¡¨æ¿")
    
    # é—œéµæŒ‡æ¨™
    col1, col2, col3, col4, col5 = st.columns(5)
    
    with col1:
        st.markdown("""
        <div class="metric-card">
            <h3>8</h3>
            <p>æ´»èºä»£ç†</p>
        </div>
        """, unsafe_allow_html=True)
    
    with col2:
        st.markdown("""
        <div class="metric-card">
            <h3>94.2%</h3>
            <p>å”ä½œæˆåŠŸç‡</p>
        </div>
        """, unsafe_allow_html=True)
    
    with col3:
        st.markdown("""
        <div class="metric-card">
            <h3>15.6%</h3>
            <p>ä»Šæ—¥æ”¶ç›Šç‡</p>
        </div>
        """, unsafe_allow_html=True)
    
    with col4:
        st.markdown("""
        <div class="metric-card">
            <h3>1.85</h3>
            <p>å¹³å‡å¤æ™®æ¯”ç‡</p>
        </div>
        """, unsafe_allow_html=True)
    
    with col5:
        st.markdown("""
        <div class="metric-card">
            <h3>156</h3>
            <p>ä»Šæ—¥æ±ºç­–æ•¸</p>
        </div>
        """, unsafe_allow_html=True)
    
    # åœ–è¡¨å€åŸŸ
    col1, col2 = st.columns(2)
    
    with col1:
        st.subheader("ä»£ç†ç¸¾æ•ˆå°æ¯”")
        # æ¨¡æ“¬ä»£ç†ç¸¾æ•ˆæ•¸æ“š
        agents = ['å·´è²ç‰¹', 'ç´¢ç¾…æ–¯', 'è¥¿è’™æ–¯', 'é”é‡Œå¥§', 'æ ¼é›·å„å§†']
        returns = [0.156, 0.142, 0.189, 0.134, 0.167]
        
        fig = px.bar(x=agents, y=returns, title="ä»£ç†ä»Šæ—¥æ”¶ç›Šç‡")
        fig.update_layout(xaxis_title="ä»£ç†", yaxis_title="æ”¶ç›Šç‡")
        st.plotly_chart(fig, use_container_width=True)
    
    with col2:
        st.subheader("æ±ºç­–å”èª¿çµ±è¨ˆ")
        # æ¨¡æ“¬å”èª¿çµ±è¨ˆ
        coordination_types = ['ä¸€è‡´æ±ºç­–', 'å¤šæ•¸æ±º', 'åŠ æ¬Šå¹³å‡', 'å°ˆå®¶å„ªå…ˆ']
        counts = [45, 28, 15, 12]
        
        fig = px.pie(values=counts, names=coordination_types, title="æ±ºç­–å”èª¿æ–¹å¼åˆ†å¸ƒ")
        st.plotly_chart(fig, use_container_width=True)
    
    # æœ€æ–°æ±ºç­–
    st.subheader("ğŸ“‹ æœ€æ–°AIæ±ºç­–")
    show_recent_ai_decisions()

def show_recent_ai_decisions():
    """é¡¯ç¤ºæœ€æ–°AIæ±ºç­–"""
    decisions = [
        {"æ™‚é–“": "14:30", "ä»£ç†": "å·´è²ç‰¹", "æ¨™çš„": "AAPL", "æ±ºç­–": "è²·å…¥", "ä¿¡å¿ƒåº¦": "85%", "ç‹€æ…‹": "âœ… å·²åŸ·è¡Œ"},
        {"æ™‚é–“": "14:28", "ä»£ç†": "ç´¢ç¾…æ–¯", "æ¨™çš„": "EURUSD", "æ±ºç­–": "è³£å‡º", "ä¿¡å¿ƒåº¦": "92%", "ç‹€æ…‹": "ğŸ”„ åŸ·è¡Œä¸­"},
        {"æ™‚é–“": "14:25", "ä»£ç†": "è¥¿è’™æ–¯", "æ¨™çš„": "TSLA", "æ±ºç­–": "æŒæœ‰", "ä¿¡å¿ƒåº¦": "78%", "ç‹€æ…‹": "âœ… å·²ç¢ºèª"},
        {"æ™‚é–“": "14:22", "ä»£ç†": "é”é‡Œå¥§", "æ¨™çš„": "çµ„åˆå†å¹³è¡¡", "æ±ºç­–": "èª¿æ•´", "ä¿¡å¿ƒåº¦": "88%", "ç‹€æ…‹": "âœ… å®Œæˆ"},
        {"æ™‚é–“": "14:20", "ä»£ç†": "æ ¼é›·å„å§†", "æ¨™çš„": "BRK.B", "æ±ºç­–": "è²·å…¥", "ä¿¡å¿ƒåº¦": "91%", "ç‹€æ…‹": "âœ… å·²åŸ·è¡Œ"}
    ]
    
    df = pd.DataFrame(decisions)
    st.dataframe(df, use_container_width=True, hide_index=True)

def show_agent_management():
    """ä»£ç†ç®¡ç†ä¸­å¿ƒ"""
    st.header("ğŸ¤– ä»£ç†ç®¡ç†ä¸­å¿ƒ")
    st.info("ğŸš§ æ•´åˆå¤šä»£ç†ç®¡ç†çµ„ä»¶ä¸­...")
    
    # é€™è£¡å°‡æ•´åˆ Phase 6 é–‹ç™¼çš„å¤šä»£ç†ç®¡ç†ç•Œé¢
    try:
        from .components.multi_agent_management import render_multi_agent_management
        render_multi_agent_management()
    except ImportError:
        st.warning("å¤šä»£ç†ç®¡ç†çµ„ä»¶æ­£åœ¨æ•´åˆä¸­ï¼Œè«‹ç¨å¾Œ...")

def show_ai_performance_monitor():
    """AIç¸¾æ•ˆç›£æ§"""
    st.header("ğŸ“ˆ AIç¸¾æ•ˆç›£æ§")
    st.info("ğŸš§ æ•´åˆAIç¸¾æ•ˆç›£æ§çµ„ä»¶ä¸­...")
    
    # é€™è£¡å°‡æ•´åˆ Phase 6 é–‹ç™¼çš„ç¸¾æ•ˆç›£æ§é¢æ¿
    try:
        from .components.agent_performance_monitor import render_agent_performance_monitor
        render_agent_performance_monitor()
    except ImportError:
        st.warning("AIç¸¾æ•ˆç›£æ§çµ„ä»¶æ­£åœ¨æ•´åˆä¸­ï¼Œè«‹ç¨å¾Œ...")

def show_intelligent_config():
    """æ™ºèƒ½é…ç½®ç®¡ç†"""
    st.header("âš™ï¸ æ™ºèƒ½é…ç½®ç®¡ç†")
    st.info("ğŸš§ æ•´åˆæ™ºèƒ½é…ç½®çµ„ä»¶ä¸­...")
    
    # é€™è£¡å°‡æ•´åˆ Phase 6 é–‹ç™¼çš„é…ç½®ç®¡ç†ç•Œé¢
    try:
        from .components.agent_configuration import render_agent_configuration
        render_agent_configuration()
    except ImportError:
        st.warning("æ™ºèƒ½é…ç½®çµ„ä»¶æ­£åœ¨æ•´åˆä¸­ï¼Œè«‹ç¨å¾Œ...")

def show_coordination_control():
    """å”ä½œæ©Ÿåˆ¶æ§åˆ¶"""
    st.header("ğŸ¤ å”ä½œæ©Ÿåˆ¶æ§åˆ¶")
    st.info("ğŸš§ æ•´åˆå”ä½œæ©Ÿåˆ¶æ§åˆ¶çµ„ä»¶ä¸­...")

def show_system_overview():
    """ç³»çµ±æ¦‚è¦½"""
    st.header("ğŸ“Š ç³»çµ±æ¦‚è¦½")
    
    # æ•´åˆå¾Œçš„ç³»çµ±æ¦‚è¦½
    col1, col2, col3 = st.columns(3)
    
    with col1:
        st.info("ğŸ¤– å¤šä»£ç†AIç³»çµ±: é‹è¡Œä¸­")
    
    with col2:
        st.info("ğŸ“ˆ å‚³çµ±é‡åŒ–ç³»çµ±: é‹è¡Œä¸­")
    
    with col3:
        st.info("ğŸ”— ç³»çµ±æ•´åˆç‹€æ…‹: æ­£å¸¸")
    
    # ç¶œåˆç¸¾æ•ˆæŒ‡æ¨™
    st.subheader("ğŸ“ˆ ç¶œåˆç¸¾æ•ˆæŒ‡æ¨™")
    
    col1, col2, col3, col4, col5, col6 = st.columns(6)
    
    metrics = [
        ("ç¸½è³‡ç”¢", "Â¥2,450,000", "3.2%"),
        ("AIæ”¶ç›Š", "Â¥156,000", "15.6%"),
        ("å‚³çµ±æ”¶ç›Š", "Â¥89,000", "8.9%"),
        ("ç¸½ç­–ç•¥æ•¸", "23", "5"),
        ("é¢¨éšªè©•åˆ†", "8.2/10", "0.3"),
        ("å¤æ™®æ¯”ç‡", "1.85", "0.12")
    ]
    
    for i, (label, value, delta) in enumerate(metrics):
        with [col1, col2, col3, col4, col5, col6][i]:
            st.metric(label, value, delta)

def show_data_management():
    """æ•¸æ“šæºç®¡ç† - æ•´åˆç‰ˆ"""
    st.header("ğŸ“ˆ æ•¸æ“šæºç®¡ç†")

    # æ•¸æ“šæºç‹€æ…‹æ¦‚è¦½
    st.subheader("ğŸ“Š æ•¸æ“šæºç‹€æ…‹")

    col1, col2 = st.columns(2)

    with col1:
        st.markdown("### ğŸ”„ ç•¶å‰é …ç›®æ•¸æ“šæº")
        current_sources = {
            "Yahoo Finance": "ğŸŸ¢ åœ¨ç·š",
            "å°ç£è­‰äº¤æ‰€": "ğŸŸ¢ åœ¨ç·š",
            "åˆ¸å•†æ¥å£": "ğŸŸ¡ éƒ¨åˆ†å¯ç”¨",
            "æ–°èæƒ…ç·’": "ğŸŸ¢ åœ¨ç·š"
        }

        for source, status in current_sources.items():
            st.markdown(f"- **{source}**: {status}")

    with col2:
        st.markdown("### ğŸ›ï¸ åŸå§‹é …ç›®æ•¸æ“šæº")
        legacy_sources = {
            "Tushare": "ğŸŸ¡ éœ€é…ç½®Token",
            "Wind": "ğŸ”´ éœ€è¨±å¯è­‰",
            "BaoStock": "ğŸŸ¢ å¯ç”¨"
        }

        for source, status in legacy_sources.items():
            st.markdown(f"- **{source}**: {status}")

    # æ•¸æ“šæºé…ç½®
    st.subheader("âš™ï¸ æ•¸æ“šæºé…ç½®")

    with st.expander("ğŸ”§ é…ç½®Tushare"):
        tushare_token = st.text_input("Tushare Token", type="password")
        if st.button("æ¸¬è©¦Tushareé€£æ¥"):
            if tushare_token:
                st.success("âœ… Tushareé€£æ¥æ¸¬è©¦æˆåŠŸ")
            else:
                st.error("âŒ è«‹è¼¸å…¥æœ‰æ•ˆçš„Token")

    with st.expander("ğŸ”§ é…ç½®Wind"):
        st.warning("Windæ•¸æ“šæºéœ€è¦å°ˆæ¥­è¨±å¯è­‰ï¼Œè«‹è¯ç¹«Windå®¢æœ")
        wind_username = st.text_input("Windç”¨æˆ¶å")
        wind_password = st.text_input("Windå¯†ç¢¼", type="password")

    # æ•¸æ“šç²å–æ¸¬è©¦
    st.subheader("ğŸ§ª æ•¸æ“šç²å–æ¸¬è©¦")

    col1, col2, col3 = st.columns(3)

    with col1:
        test_symbol = st.text_input("æ¸¬è©¦è‚¡ç¥¨ä»£ç¢¼", value="AAPL")

    with col2:
        test_source = st.selectbox("é¸æ“‡æ•¸æ“šæº", ["Yahoo", "Tushare", "BaoStock"])

    with col3:
        if st.button("ğŸš€ æ¸¬è©¦ç²å–"):
            with st.spinner("æ­£åœ¨ç²å–æ•¸æ“š..."):
                # æ¨¡æ“¬æ•¸æ“šç²å–
                import time
                time.sleep(2)
                st.success(f"âœ… æˆåŠŸå¾{test_source}ç²å–{test_symbol}æ•¸æ“š")

    # æ•¸æ“šè³ªé‡ç›£æ§
    st.subheader("ğŸ“Š æ•¸æ“šè³ªé‡ç›£æ§")

    quality_metrics = {
        "æ•¸æ“šå®Œæ•´æ€§": 98.5,
        "æ•¸æ“šåŠæ™‚æ€§": 99.2,
        "æ•¸æ“šæº–ç¢ºæ€§": 97.8,
        "æ•¸æ“šä¸€è‡´æ€§": 96.5
    }

    cols = st.columns(len(quality_metrics))
    for i, (metric, value) in enumerate(quality_metrics.items()):
        with cols[i]:
            st.metric(metric, f"{value}%", f"{value-95:.1f}%")

def show_strategy_backtest():
    """ç­–ç•¥å›æ¸¬ - æ•´åˆç‰ˆ"""
    st.header("ğŸ§  ç­–ç•¥å›æ¸¬")

    # å›æ¸¬é¡å‹é¸æ“‡
    st.subheader("ğŸ¯ å›æ¸¬é¡å‹é¸æ“‡")

    col1, col2 = st.columns(2)

    with col1:
        st.markdown("### ğŸ¤– AIä»£ç†å›æ¸¬")
        ai_backtest_options = [
            "å–®ä¸€ä»£ç†å›æ¸¬",
            "å¤šä»£ç†å”ä½œå›æ¸¬",
            "ä»£ç†å°æ¯”å›æ¸¬",
            "ä»£ç†çµ„åˆå„ªåŒ–"
        ]
        ai_backtest_type = st.selectbox("é¸æ“‡AIå›æ¸¬é¡å‹", ai_backtest_options)

    with col2:
        st.markdown("### ğŸ“ˆ å‚³çµ±ç­–ç•¥å›æ¸¬")
        traditional_backtest_options = [
            "æŠ€è¡“æŒ‡æ¨™ç­–ç•¥",
            "åŸºæœ¬é¢ç­–ç•¥",
            "é‡åŒ–å› å­ç­–ç•¥",
            "è‡ªå®šç¾©ç­–ç•¥"
        ]
        traditional_backtest_type = st.selectbox("é¸æ“‡å‚³çµ±å›æ¸¬é¡å‹", traditional_backtest_options)

    # å›æ¸¬åƒæ•¸è¨­ç½®
    st.subheader("âš™ï¸ å›æ¸¬åƒæ•¸è¨­ç½®")

    col1, col2, col3 = st.columns(3)

    with col1:
        start_date = st.date_input("é–‹å§‹æ—¥æœŸ", value=pd.to_datetime("2023-01-01"))
        end_date = st.date_input("çµæŸæ—¥æœŸ", value=pd.to_datetime("2024-01-01"))

    with col2:
        initial_capital = st.number_input("åˆå§‹è³‡é‡‘", value=1000000, step=100000)
        commission_rate = st.number_input("æ‰‹çºŒè²»ç‡", value=0.0003, step=0.0001, format="%.4f")

    with col3:
        benchmark = st.selectbox("åŸºæº–æŒ‡æ•¸", ["æ»¬æ·±300", "ä¸­è­‰500", "å‰µæ¥­æ¿æŒ‡", "è‡ªå®šç¾©"])
        max_position = st.slider("æœ€å¤§å–®ä¸€å€‰ä½", 0.05, 0.5, 0.2, 0.05)

    # ç­–ç•¥é¸æ“‡å’Œé…ç½®
    if ai_backtest_type == "å¤šä»£ç†å”ä½œå›æ¸¬":
        st.subheader("ğŸ¤– ä»£ç†é¸æ“‡å’Œé…ç½®")

        col1, col2 = st.columns(2)

        with col1:
            st.markdown("#### é¸æ“‡ä»£ç†")
            agents = {
                "å·´è²ç‰¹ä»£ç†": st.checkbox("å·´è²ç‰¹ä»£ç†", value=True),
                "ç´¢ç¾…æ–¯ä»£ç†": st.checkbox("ç´¢ç¾…æ–¯ä»£ç†", value=True),
                "è¥¿è’™æ–¯ä»£ç†": st.checkbox("è¥¿è’™æ–¯ä»£ç†", value=False),
                "é”é‡Œå¥§ä»£ç†": st.checkbox("é”é‡Œå¥§ä»£ç†", value=True),
                "æ ¼é›·å„å§†ä»£ç†": st.checkbox("æ ¼é›·å„å§†ä»£ç†", value=False)
            }

        with col2:
            st.markdown("#### æ¬Šé‡é…ç½®")
            total_weight = 0
            weights = {}
            for agent, selected in agents.items():
                if selected:
                    weight = st.slider(f"{agent}æ¬Šé‡", 0.0, 1.0, 0.25, 0.05, key=f"weight_{agent}")
                    weights[agent] = weight
                    total_weight += weight

            if total_weight > 0:
                st.info(f"ç¸½æ¬Šé‡: {total_weight:.2f}")

    # å›æ¸¬åŸ·è¡Œ
    st.subheader("ğŸš€ åŸ·è¡Œå›æ¸¬")

    col1, col2, col3 = st.columns(3)

    with col1:
        if st.button("ğŸš€ é–‹å§‹å›æ¸¬", type="primary"):
            with st.spinner("æ­£åœ¨åŸ·è¡Œå›æ¸¬..."):
                # æ¨¡æ“¬å›æ¸¬åŸ·è¡Œ
                import time
                progress_bar = st.progress(0)
                for i in range(100):
                    time.sleep(0.02)
                    progress_bar.progress(i + 1)

                st.success("âœ… å›æ¸¬å®Œæˆï¼")

    with col2:
        if st.button("ğŸ“Š æŸ¥çœ‹çµæœ"):
            st.info("å›æ¸¬çµæœå°‡åœ¨ä¸‹æ–¹é¡¯ç¤º")

    with col3:
        if st.button("ğŸ’¾ ä¿å­˜é…ç½®"):
            st.success("âœ… é…ç½®å·²ä¿å­˜")

    # å›æ¸¬çµæœå±•ç¤º
    st.subheader("ğŸ“Š å›æ¸¬çµæœ")

    # æ¨¡æ“¬å›æ¸¬çµæœ
    if st.session_state.get('show_backtest_results', False):
        show_backtest_results()
    else:
        st.info("è«‹å…ˆåŸ·è¡Œå›æ¸¬ä»¥æŸ¥çœ‹çµæœ")

def show_backtest_results():
    """é¡¯ç¤ºå›æ¸¬çµæœ"""
    # ç¸¾æ•ˆæŒ‡æ¨™
    col1, col2, col3, col4 = st.columns(4)

    with col1:
        st.metric("ç¸½æ”¶ç›Šç‡", "23.45%", "5.67%")

    with col2:
        st.metric("å¹´åŒ–æ”¶ç›Šç‡", "18.92%", "3.21%")

    with col3:
        st.metric("å¤æ™®æ¯”ç‡", "1.85", "0.23")

    with col4:
        st.metric("æœ€å¤§å›æ’¤", "-8.76%", "2.34%")

    # æ”¶ç›Šæ›²ç·šåœ–
    col1, col2 = st.columns(2)

    with col1:
        st.subheader("ğŸ“ˆ æ”¶ç›Šæ›²ç·š")
        # æ¨¡æ“¬æ”¶ç›Šæ›²ç·šæ•¸æ“š
        dates = pd.date_range(start='2023-01-01', end='2024-01-01', freq='D')
        portfolio_value = [1000000 * (1 + 0.0002 * i + np.random.normal(0, 0.01)) for i in range(len(dates))]
        benchmark_value = [1000000 * (1 + 0.0001 * i + np.random.normal(0, 0.008)) for i in range(len(dates))]

        fig = go.Figure()
        fig.add_trace(go.Scatter(x=dates, y=portfolio_value, mode='lines', name='æŠ•è³‡çµ„åˆ'))
        fig.add_trace(go.Scatter(x=dates, y=benchmark_value, mode='lines', name='åŸºæº–æŒ‡æ•¸'))
        fig.update_layout(title="æŠ•è³‡çµ„åˆvsåŸºæº–è¡¨ç¾", xaxis_title="æ—¥æœŸ", yaxis_title="åƒ¹å€¼")
        st.plotly_chart(fig, use_container_width=True)

    with col2:
        st.subheader("ğŸ“Š å›æ’¤åˆ†æ")
        # æ¨¡æ“¬å›æ’¤æ•¸æ“š
        drawdown = [max(0, (max(portfolio_value[:i+1]) - portfolio_value[i]) / max(portfolio_value[:i+1])) for i in range(len(portfolio_value))]

        fig = go.Figure()
        fig.add_trace(go.Scatter(x=dates, y=[-d for d in drawdown], mode='lines', fill='tonexty', name='å›æ’¤'))
        fig.update_layout(title="å›æ’¤åˆ†æ", xaxis_title="æ—¥æœŸ", yaxis_title="å›æ’¤æ¯”ä¾‹")
        st.plotly_chart(fig, use_container_width=True)

def show_portfolio_management():
    """æŠ•è³‡çµ„åˆç®¡ç†"""
    st.header("ğŸ’¼ æŠ•è³‡çµ„åˆç®¡ç†")
    st.info("ğŸš§ æ•´åˆæŠ•è³‡çµ„åˆç®¡ç†åŠŸèƒ½ä¸­...")

def show_risk_management():
    """é¢¨éšªæ§åˆ¶"""
    st.header("âš ï¸ é¢¨éšªæ§åˆ¶")
    st.info("ğŸš§ æ•´åˆé¢¨éšªæ§åˆ¶åŠŸèƒ½ä¸­...")

def show_system_settings():
    """ç³»çµ±é…ç½®"""
    st.header("ğŸ”§ ç³»çµ±é…ç½®")
    st.info("ğŸš§ æ•´åˆç³»çµ±é…ç½®åŠŸèƒ½ä¸­...")

if __name__ == "__main__":
    main()
